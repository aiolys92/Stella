<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Liste Compl√®te - Catalogue Optimis√©</title>
  <meta name="description" content="Catalogue optimis√© de toutes les monnaies, gemmes et objets">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="content fade-in">
    <!-- En-t√™te optimis√© -->
    <header class="page-header">
      <h1>üìö CATALOGUE COMPLET üìö</h1>
      <p class="page-subtitle">Base de donn√©es compl√®te et optimis√©e</p>
    </header>

    <!-- Contr√¥les et statistiques -->
    <section class="section">
      <div class="controls-header">
        <div class="controls-left">
          <h2>üîç Exploration Intelligente</h2>
        </div>
        <div class="controls-right">
          <button onclick="exportData()" class="btn-action btn-save">üíæ Exporter</button>
          <button onclick="resetFilters()" class="btn-action btn-load">üîÑ Reset</button>
        </div>
      </div>
      
      <!-- Statistiques en temps r√©el -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalCount">0</div>
          <div class="stat-label">Total Objets</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="visibleCount">0</div>
          <div class="stat-label">Affich√©s</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="maxValue">0</div>
          <div class="stat-label">Valeur Max (PM)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgValue">0</div>
          <div class="stat-label">Moyenne (PM)</div>
        </div>
      </div>
    </section>

    <!-- Recherche et filtres optimis√©s -->
    <section class="section">
      <div class="search-panel">
        <div class="search-main">
          <input type="text" id="globalSearch" placeholder="üîç Recherche globale..." class="search-input-main">
          <div class="search-suggestions" id="searchSuggestions"></div>
        </div>
        
        <div class="filters-compact">
          <select id="categoryFilter" class="filter-select">
            <option value="">üìã Toutes cat√©gories</option>
            <option value="pieces">ü™ô Monnaies</option>
            <option value="gemmes">üíé Gemmes</option>
            <option value="poids">‚öñÔ∏è Objets</option>
          </select>
          
          <select id="sortFilter" class="filter-select">
            <option value="value-desc">üí∞ Plus cher</option>
            <option value="value-asc">üí∞ Moins cher</option>
            <option value="name-asc">üî§ A ‚Üí Z</option>
            <option value="name-desc">üî§ Z ‚Üí A</option>
            <option value="rarity">‚ú® Raret√©</option>
          </select>
          
          <div class="filter-toggle">
            <button onclick="toggleAdvanced()" class="btn-filter" id="advancedBtn">‚öôÔ∏è Filtres</button>
          </div>
        </div>
      </div>

      <!-- Filtres avanc√©s (masqu√©s par d√©faut) -->
      <div class="advanced-panel" id="advancedPanel" style="display: none;">
        <div class="advanced-grid">
          <div class="filter-group">
            <label>üí∞ Valeur (PM)</label>
            <div class="range-inputs">
              <input type="number" id="minValue" placeholder="Min" class="range-input">
              <span>‚Äî</span>
              <input type="number" id="maxValue" placeholder="Max" class="range-input">
            </div>
          </div>
          
          <div class="filter-group">
            <label>üé® Couleur</label>
            <select id="colorFilter" class="filter-select">
              <option value="">Toutes</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>üíé Duret√©</label>
            <select id="hardnessFilter" class="filter-select">
              <option value="">Toutes</option>
              <option value="1-3">Tendre (1-3)</option>
              <option value="4-6">Moyen (4-6)</option>
              <option value="7-10">Dur (7-10)</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>üîÆ Propri√©t√©s</label>
            <input type="text" id="propertyFilter" placeholder="Symbolique, notes..." class="filter-input">
          </div>
        </div>
      </div>
    </section>

    <!-- R√©sultats optimis√©s -->
    <section class="section">
      <div class="results-header">
        <h2>üìä R√©sultats</h2>
        <div class="view-controls">
          <button onclick="setView('cards')" class="view-btn active" id="cardsBtn">üé¥ Cartes</button>
          <button onclick="setView('table')" class="view-btn" id="tableBtn">üìã Tableau</button>
          <button onclick="setView('compact')" class="view-btn" id="compactBtn">üìù Compact</button>
        </div>
      </div>

      <!-- Vue en cartes (par d√©faut) -->
      <div class="results-container" id="resultsContainer">
        <div class="cards-grid" id="cardsView">
          <!-- G√©n√©r√© dynamiquement -->
        </div>

        <!-- Vue tableau -->
        <div class="table-view" id="tableView" style="display: none;">
          <div class="table-container">
            <table class="results-table">
              <thead>
                <tr>
                  <th>Nom</th>
                  <th>Cat√©gorie</th>
                  <th>Valeur/Poids</th>
                  <th>Type</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Vue compacte -->
        <div class="compact-view" id="compactView" style="display: none;">
          <div class="compact-list" id="compactList">
            <!-- G√©n√©r√© dynamiquement -->
          </div>
        </div>
      </div>

      <!-- Indicateur de chargement -->
      <div class="loading-indicator" id="loadingIndicator" style="display: none;">
        <div class="spinner"></div>
        <p>Chargement des donn√©es...</p>
      </div>

      <!-- Message vide -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-icon">üîç</div>
        <h3>Aucun r√©sultat trouv√©</h3>
        <p>Essayez de modifier vos crit√®res de recherche</p>
        <button onclick="resetFilters()" class="btn-action">üîÑ R√©initialiser</button>
      </div>
    </section>

    <!-- Modal de d√©tails optimis√© -->
    <div id="detailModal" class="modal-overlay" onclick="closeDetail()">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h2 id="modalTitle">D√©tails</h2>
          <button onclick="closeDetail()" class="modal-close">‚úï</button>
        </div>
        
        <div class="modal-body" id="modalBody">
          <!-- Contenu g√©n√©r√© dynamiquement -->
        </div>
        
        <div class="modal-footer">
          <button onclick="copyDetails()" class="btn-action">üìã Copier</button>
          <button onclick="closeDetail()" class="btn-action btn-secondary">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts dans l'ordre correct -->
  <script src="data.js"></script>
  <script src="nav.js"></script>
  <script>
    // ===== VARIABLES GLOBALES =====
    let allData = [];
    let filteredData = [];
    let currentView = 'cards';
    let searchTimeout = null;

    // ===== INITIALISATION =====
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üìö Catalogue Optimis√© - Initialis√©');
      
      // Attendre que les donn√©es soient charg√©es
      if (!window.monnaies) {
        setTimeout(() => {
          initializeCatalog();
        }, 100);
      } else {
        initializeCatalog();
      }
    });

    function initializeCatalog() {
      loadAllData();
      setupEventListeners();
      renderData();
      updateStats();
    }

    // ===== CHARGEMENT DES DONN√âES =====
    function loadAllData() {
      allData = [];
      
      // V√©rifier la disponibilit√© des donn√©es
      if (!window.monnaies) {
        console.error('Donn√©es non disponibles');
        return;
      }
      
      // Charger les monnaies
      if (window.monnaies.pieces) {
        Object.entries(window.monnaies.pieces).forEach(([name, value]) => {
          allData.push({
            id: `pieces_${name}`,
            name: name,
            category: 'pieces',
            categoryLabel: 'Monnaie',
            value: value,
            unit: 'PM',
            type: 'M√©tallique',
            rarity: getMonnaieRarity(value),
            usage: getUsageFrequency(name),
            searchableText: `${name} monnaie m√©tallique PM`
          });
        });
      }

      // Charger les gemmes avec d√©tails complets
      if (window.gemmesDetaillees) {
        Object.entries(window.gemmesDetaillees).forEach(([name, details]) => {
          const searchText = `${name} ${details.surnom || ''} ${details.couleur} ${details.symbolique} ${details.notes} ${details.lienDivin} ${details.lienZodiacal}`.toLowerCase();
          
          allData.push({
            id: `gemmes_${name}`,
            name: name,
            category: 'gemmes',
            categoryLabel: 'Gemme',
            value: details.valeur,
            unit: 'PM',
            type: details.couleur,
            rarity: getGemmeRarity(details.valeur),
            surnom: details.surnom,
            couleur: details.couleur,
            durete: details.durete,
            symbolique: details.symbolique,
            lienDivin: details.lienDivin,
            lienZodiacal: details.lienZodiacal,
            notes: details.notes,
            searchableText: searchText
          });
        });
      }

      // Charger les objets avec poids
      if (window.monnaies && window.monnaies.poids) {
        Object.entries(window.monnaies.poids).forEach(([categorie, objets]) => {
          Object.entries(objets).forEach(([name, poids]) => {
            allData.push({
              id: `poids_${name}`,
              name: name,
              category: 'poids',
              categoryLabel: 'Objet',
              value: poids,
              unit: 'kg',
              type: categorie,
              rarity: 'Commun',
              searchableText: `${name} ${categorie} poids objet kg`.toLowerCase()
            });
          });
        });
      }

      filteredData = [...allData];
      populateColorFilter();
      
      console.log(`üìä Donn√©es charg√©es: ${allData.length} √©l√©ments`);
    }

    // ===== UTILITAIRES =====
    function getMonnaieRarity(value) {
      if (value >= 3) return 'Tr√®s Rare';
      if (value >= 1) return 'Rare';
      if (value >= 0.1) return 'Commune';
      return 'Fr√©quente';
    }

    function getGemmeRarity(value) {
      if (value >= 100) return 'L√©gendaire';
      if (value >= 50) return 'Tr√®s Rare';
      if (value >= 20) return 'Rare';
      if (value >= 5) return 'Peu Commune';
      if (value >= 1) return 'Commune';
      return 'Fr√©quente';
    }

    function getUsageFrequency(name) {
      const frequent = ['Or', 'Argent', 'Fer'];
      const occasionnel = ['Platine', '√âlectrum'];
      if (frequent.includes(name)) return 'Fr√©quent';
      if (occasionnel.includes(name)) return 'Occasionnel';
      return 'Rare';
    }

    // ===== POPULATION DES FILTRES =====
    function populateColorFilter() {
      const colorSelect = document.getElementById('colorFilter');
      const colors = new Set();
      
      allData.forEach(item => {
        if (item.couleur) {
          item.couleur.split('/').forEach(color => {
            colors.add(color.trim());
          });
        }
      });
      
      Array.from(colors).sort().forEach(color => {
        const option = document.createElement('option');
        option.value = color;
        option.textContent = color;
        colorSelect.appendChild(option);
      });
    }

    // ===== √âV√âNEMENTS =====
    function setupEventListeners() {
      // Recherche avec debounce
      document.getElementById('globalSearch').addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          applyFilters();
        }, 300);
      });

      // Filtres instantan√©s
      ['categoryFilter', 'sortFilter', 'colorFilter', 'hardnessFilter'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener('change', applyFilters);
        }
      });

      // Filtres de valeur avec debounce
      ['minValue', 'maxValue', 'propertyFilter'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(applyFilters, 500);
          });
        }
      });
    }

    // ===== FILTRAGE =====
    function applyFilters() {
      const searchTerm = document.getElementById('globalSearch').value.toLowerCase();
      const category = document.getElementById('categoryFilter').value;
      const color = document.getElementById('colorFilter').value;
      const hardness = document.getElementById('hardnessFilter').value;
      const property = document.getElementById('propertyFilter').value.toLowerCase();
      const minVal = parseFloat(document.getElementById('minValue').value) || 0;
      const maxVal = parseFloat(document.getElementById('maxValue').value) || Infinity;
      const sort = document.getElementById('sortFilter').value;

      // Filtrer
      filteredData = allData.filter(item => {
        // Recherche globale
        if (searchTerm && !item.searchableText.includes(searchTerm)) return false;
        
        // Cat√©gorie
        if (category && item.category !== category) return false;
        
        // Couleur
        if (color && (!item.couleur || !item.couleur.includes(color))) return false;
        
        // Duret√©
        if (hardness && item.category === 'gemmes') {
          const [min, max] = hardness.split('-').map(Number);
          const itemHardness = parseFloat(String(item.durete).replace(/[^0-9.]/g, '')) || 0;
          if (itemHardness < min || itemHardness > max) return false;
        }
        
        // Propri√©t√©s
        if (property && !item.searchableText.includes(property)) return false;
        
        // Valeur (seulement pour PM)
        if (item.unit === 'PM' && (item.value < minVal || item.value > maxVal)) return false;
        
        return true;
      });

      // Trier
      filteredData.sort((a, b) => {
        switch (sort) {
          case 'value-desc': return b.value - a.value;
          case 'value-asc': return a.value - b.value;
          case 'name-asc': return a.name.localeCompare(b.name);
          case 'name-desc': return b.name.localeCompare(a.name);
          case 'rarity': return getRarityWeight(b.rarity) - getRarityWeight(a.rarity);
          default: return 0;
        }
      });

      renderData();
      updateStats();
    }

    function getRarityWeight(rarity) {
      const weights = {
        'L√©gendaire': 6,
        'Tr√®s Rare': 5,
        'Rare': 4,
        'Peu Commune': 3,
        'Commune': 2,
        'Fr√©quente': 1,
        'Commun': 1
      };
      return weights[rarity] || 0;
    }

    // ===== RENDU DES DONN√âES =====
    function renderData() {
      if (filteredData.length === 0) {
        showEmptyState();
        return;
      }

      hideEmptyState();
      
      switch (currentView) {
        case 'cards': renderCards(); break;
        case 'table': renderTable(); break;
        case 'compact': renderCompact(); break;
      }
    }

    function renderCards() {
      const container = document.getElementById('cardsView');
      container.innerHTML = '';

      filteredData.forEach(item => {
        const card = document.createElement('div');
        card.className = `item-card ${item.category}`;
        
        const rarityClass = item.rarity.toLowerCase().replace(/[^a-z]/g, '-');
        const valueDisplay = item.unit === 'PM' ? `${item.value.toFixed(2)} PM` : `${item.value} kg`;
        
        card.innerHTML = `
          <div class="card-header">
            <h3 class="card-title">${item.name}</h3>
            ${item.surnom ? `<div class="card-subtitle">${item.surnom}</div>` : ''}
            <span class="category-tag ${item.category}">${item.categoryLabel}</span>
          </div>
          
          <div class="card-body">
            <div class="card-value">
              <span class="value-number">${valueDisplay}</span>
            </div>
            
            <div class="card-details">
              <div class="detail-row">
                <span class="detail-label">Type:</span>
                <span class="detail-value">${item.type}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Raret√©:</span>
                <span class="rarity-badge ${rarityClass}">${item.rarity}</span>
              </div>
              ${item.durete ? `
                <div class="detail-row">
                  <span class="detail-label">Duret√©:</span>
                  <span class="detail-value">${item.durete}</span>
                </div>
              ` : ''}
            </div>
          </div>
          
          <div class="card-footer">
            <button onclick="showDetail('${item.id}')" class="btn-detail">üëÅÔ∏è D√©tails</button>
          </div>
        `;
        
        container.appendChild(card);
      });
    }

    function renderTable() {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';

      filteredData.forEach(item => {
        const row = tbody.insertRow();
        const valueDisplay = item.unit === 'PM' ? `${item.value.toFixed(2)} PM` : `${item.value} kg`;
        
        row.innerHTML = `
          <td>
            <strong>${item.name}</strong>
            ${item.surnom ? `<br><small class="text-muted">${item.surnom}</small>` : ''}
          </td>
          <td><span class="category-tag ${item.category}">${item.categoryLabel}</span></td>
          <td>${valueDisplay}</td>
          <td>${item.type}</td>
          <td><button onclick="showDetail('${item.id}')" class="btn-detail btn-sm">üëÅÔ∏è</button></td>
        `;
      });
    }

    function renderCompact() {
      const container = document.getElementById('compactList');
      container.innerHTML = '';

      filteredData.forEach(item => {
        const div = document.createElement('div');
        div.className = 'compact-item';
        
        const valueDisplay = item.unit === 'PM' ? `${item.value.toFixed(2)} PM` : `${item.value} kg`;
        
        div.innerHTML = `
          <div class="compact-main">
            <span class="compact-name">${item.name}</span>
            ${item.surnom ? `<span class="compact-subtitle">(${item.surnom})</span>` : ''}
            <span class="compact-value">${valueDisplay}</span>
          </div>
          <button onclick="showDetail('${item.id}')" class="btn-detail btn-xs">üëÅÔ∏è</button>
        `;
        
        container.appendChild(div);
      });
    }

    // ===== GESTION DES VUES =====
    function setView(viewType) {
      currentView = viewType;
      
      // Mettre √† jour les boutons
      document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(viewType + 'Btn').classList.add('active');
      
      // Masquer toutes les vues
      ['cardsView', 'tableView', 'compactView'].forEach(id => {
        document.getElementById(id).style.display = 'none';
      });
      
      // Afficher la vue s√©lectionn√©e
      document.getElementById(viewType + 'View').style.display = 'block';
      
      renderData();
    }

    // ===== MODAL DE D√âTAILS =====
    function showDetail(itemId) {
      const item = allData.find(i => i.id === itemId);
      if (!item) return;

      document.getElementById('modalTitle').textContent = item.name;
      
      const modalBody = document.getElementById('modalBody');
      
      if (item.category === 'gemmes') {
        modalBody.innerHTML = `
          <div class="detail-grid">
            <div class="detail-section">
              <h4>üîç Informations G√©n√©rales</h4>
              <div class="info-row"><strong>Nom:</strong> ${item.name}</div>
              ${item.surnom ? `<div class="info-row"><strong>Surnom:</strong> <em>"${item.surnom}"</em></div>` : ''}
              <div class="info-row"><strong>Couleur:</strong> <span class="color-indicator">${item.couleur}</span></div>
              <div class="info-row"><strong>Duret√©:</strong> ${item.durete}</div>
              <div class="info-row"><strong>Valeur:</strong> ${item.value} PM</div>
            </div>
            
            <div class="detail-section">
              <h4>üîÆ Propri√©t√©s Mystiques</h4>
              ${item.symbolique ? `<div class="info-row"><strong>Symbolique:</strong> ${item.symbolique}</div>` : ''}
              ${item.lienDivin ? `<div class="info-row"><strong>Liens Divins:</strong> ${item.lienDivin}</div>` : ''}
              ${item.lienZodiacal ? `<div class="info-row"><strong>Liens Zodiacaux:</strong> ${item.lienZodiacal}</div>` : ''}
              ${item.notes ? `<div class="info-row"><strong>Notes:</strong> ${item.notes}</div>` : ''}
            </div>
          </div>
        `;
      } else if (item.category === 'pieces') {
        const goldRatio = (item.value / (window.monnaies.pieces['Or'] || 1)).toFixed(2);
        modalBody.innerHTML = `
          <div class="detail-grid">
            <div class="detail-section">
              <h4>ü™ô Informations Mon√©taires</h4>
              <div class="info-row"><strong>Nom:</strong> ${item.name}</div>
              <div class="info-row"><strong>Type:</strong> ${item.type}</div>
              <div class="info-row"><strong>Valeur:</strong> ${item.value.toFixed(4)} PM</div>
              <div class="info-row"><strong>Ratio √† l'Or:</strong> ${goldRatio}√ó</div>
              <div class="info-row"><strong>Usage:</strong> ${item.usage}</div>
            </div>
          </div>
        `;
      } else {
        modalBody.innerHTML = `
          <div class="detail-grid">
            <div class="detail-section">
              <h4>‚öñÔ∏è Informations Objet</h4>
              <div class="info-row"><strong>Nom:</strong> ${item.name}</div>
              <div class="info-row"><strong>Cat√©gorie:</strong> ${item.type}</div>
              <div class="info-row"><strong>Poids:</strong> ${item.value} kg</div>
            </div>
          </div>
        `;
      }
      
      document.getElementById('detailModal').classList.add('active');
    }

    function closeDetail() {
      document.getElementById('detailModal').classList.remove('active');
    }

    // ===== UTILITAIRES INTERFACE =====
    function toggleAdvanced() {
      const panel = document.getElementById('advancedPanel');
      const btn = document.getElementById('advancedBtn');
      
      if (panel.style.display === 'none') {
        panel.style.display = 'block';
        btn.textContent = '‚öôÔ∏è Masquer';
      } else {
        panel.style.display = 'none';
        btn.textContent = '‚öôÔ∏è Filtres';
      }
    }

    function resetFilters() {
      document.getElementById('globalSearch').value = '';
      document.getElementById('categoryFilter').value = '';
      document.getElementById('sortFilter').value = 'value-desc';
      document.getElementById('colorFilter').value = '';
      document.getElementById('hardnessFilter').value = '';
      document.getElementById('propertyFilter').value = '';
      document.getElementById('minValue').value = '';
      document.getElementById('maxValue').value = '';
      
      applyFilters();
      showNotification('üîÑ Filtres r√©initialis√©s');
    }

    function showEmptyState() {
      document.getElementById('resultsContainer').style.display = 'none';
      document.getElementById('emptyState').style.display = 'block';
    }

    function hideEmptyState() {
      document.getElementById('resultsContainer').style.display = 'block';
      document.getElementById('emptyState').style.display = 'none';
    }

    function updateStats() {
      document.getElementById('totalCount').textContent = allData.length;
      document.getElementById('visibleCount').textContent = filteredData.length;
      
      const valuableItems = filteredData.filter(item => item.unit === 'PM');
      if (valuableItems.length > 0) {
        const maxVal = Math.max(...valuableItems.map(item => item.value));
        const avgVal = valuableItems.reduce((sum, item) => sum + item.value, 0) / valuableItems.length;
        
        document.getElementById('maxValue').textContent = maxVal.toFixed(2);
        document.getElementById('avgValue').textContent = avgVal.toFixed(2);
      } else {
        document.getElementById('maxValue').textContent = '0';
        document.getElementById('avgValue').textContent = '0';
      }
    }

    // ===== EXPORT ET UTILITAIRES =====
    function exportData() {
      const exportData = {
        timestamp: new Date().toISOString(),
        total: allData.length,
        filtered: filteredData.length,
        data: filteredData
      };
      
      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `catalogue_${new Date().toISOString().slice(0, 10)}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification('üíæ Donn√©es export√©es');
    }

    function copyDetails() {
      const content = document.getElementById('modalBody').textContent;
      navigator.clipboard.writeText(content).then(() => {
        showNotification('üìã D√©tails copi√©s');
      });
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 10000;
        background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);
        color: white; padding: 15px 25px; border-radius: 8px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        font-family: "Quattrocento Sans", Arial, sans-serif;
        font-weight: bold; font-size: 14px;
        border: 2px solid #228B22;
        animation: slideInNotif 0.3s ease;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOutNotif 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // ===== EXPOSITION DES FONCTIONS =====
    window.setView = setView;
    window.toggleAdvanced = toggleAdvanced;
    window.resetFilters = resetFilters;
    window.showDetail = showDetail;
    window.closeDetail = closeDetail;
    window.exportData = exportData;
    window.copyDetails = copyDetails;
  </script>

  <!-- Styles optimis√©s pour la liste -->
  <style>
    /* ===== STYLES SP√âCIFIQUES √Ä LA LISTE ===== */
    
    /* Grille de statistiques */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--content-bg) 0%, #FAF7F0 100%);
      padding: 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      text-align: center;
      border: 2px solid var(--accent-gold);
      position: relative;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--accent-gold);
      border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: var(--primary-bg);
      margin-bottom: 0.5rem;
      font-family: var(--font-title);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--primary-dark);
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-family: var(--font-ui);
      font-weight: 600;
    }

    /* Panneau de recherche */
    .search-panel {
      background: linear-gradient(135deg, var(--content-bg) 0%, var(--secondary-bg) 100%);
      padding: 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
      border: 2px solid var(--border-color);
    }

    .search-input-main {
      width: 100%;
      padding: 1rem 1.5rem;
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 1.1rem;
      font-family: var(--font-ui);
      background: var(--content-bg);
      transition: var(--transition);
    }

    .search-input-main:focus {
      outline: none;
      border-color: var(--accent-gold);
      box-shadow: 0 0 8px rgba(218, 165, 32, 0.3);
    }

    .filters-compact {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .filter-select, .filter-input {
      padding: 0.75rem;
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      background: var(--content-bg);
      font-family: var(--font-ui);
    }

    .btn-filter {
      padding: 0.75rem 1.5rem;
      border: 2px solid var(--primary-bg);
      background: var(--primary-bg);
      color: var(--text-light);
      border-radius: var(--border-radius);
      cursor: pointer;
      font-family: var(--font-ui);
      font-weight: 600;
      transition: var(--transition);
    }

    .btn-filter:hover {
      background: var(--accent-gold);
      border-color: var(--accent-gold);
      color: var(--primary-dark);
    }

    /* Filtres avanc√©s */
    .advanced-panel {
      background: linear-gradient(135deg, var(--secondary-bg) 0%, #F0E6D2 100%);
      padding: 1.5rem;
      border-radius: var(--border-radius);
      margin-top: 1rem;
      border: 1px solid var(--border-color);
    }

    .advanced-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
    }

    .filter-group label {
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: var(--primary-dark);
      font-family: var(--font-title);
    }

    .range-inputs {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .range-input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
    }

    /* En-t√™te des r√©sultats */
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding: 15px 20px;
      background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--content-bg) 100%);
      border-radius: var(--border-radius);
    }

    .view-controls {
      display: flex;
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      overflow: hidden;
    }

    .view-btn {
      padding: 0.75rem 1rem;
      border: none;
      background: var(--content-bg);
      cursor: pointer;
      transition: var(--transition);
      font-family: var(--font-ui);
      font-weight: 600;
      border-right: 1px solid var(--border-color);
    }

    .view-btn:last-child {
      border-right: none;
    }

    .view-btn.active {
      background: var(--primary-bg);
      color: var(--text-light);
    }

    .view-btn:hover:not(.active) {
      background: rgba(218, 165, 32, 0.1);
    }

    /* Vue en cartes */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .item-card {
      background: var(--content-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: var(--transition);
      border: 2px solid var(--border-color);
    }

    .item-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-dark);
      border-color: var(--accent-gold);
    }

    .item-card.pieces {
      border-left: 4px solid #FFB347;
    }

    .item-card.gemmes {
      border-left: 4px solid #9370DB;
    }

    .item-card.poids {
      border-left: 4px solid #20B2AA;
    }

    .card-header {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
      background: linear-gradient(135deg, var(--content-bg) 0%, #FAF7F0 100%);
    }

    .card-title {
      font-size: 1.2rem;
      color: var(--primary-bg);
      margin-bottom: 0.25rem;
      font-family: var(--font-title);
    }

    .card-subtitle {
      font-size: 0.9rem;
      color: var(--primary-dark);
      opacity: 0.7;
      font-style: italic;
      margin-bottom: 0.5rem;
    }

    .category-tag {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: bold;
      text-transform: uppercase;
      font-family: var(--font-ui);
    }

    .category-tag.pieces {
      background: #FFE4B5;
      color: #8B4513;
    }

    .category-tag.gemmes {
      background: #E6E6FA;
      color: #4B0082;
    }

    .category-tag.poids {
      background: #E0F6FF;
      color: #008B8B;
    }

    .card-body {
      padding: 1rem;
    }

    .card-value {
      text-align: center;
      margin-bottom: 1rem;
      padding: 10px;
      background: rgba(218, 165, 32, 0.1);
      border-radius: var(--border-radius);
    }

    .value-number {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--primary-bg);
      font-family: var(--font-title);
    }

    .card-details {
      margin-top: 0.5rem;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.25rem 0;
      border-bottom: 1px solid rgba(139, 69, 19, 0.1);
    }

    .detail-label {
      font-weight: 500;
      color: var(--primary-dark);
      opacity: 0.8;
    }

    .detail-value {
      font-weight: bold;
      color: var(--primary-bg);
    }

    .rarity-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: bold;
      text-transform: uppercase;
    }

    .rarity-badge.l√©gendaire { background: #FF6B6B; color: white; }
    .rarity-badge.tr√®s-rare { background: #FFD93D; color: #8B4513; }
    .rarity-badge.rare { background: #DDA0DD; color: #4B0082; }
    .rarity-badge.peu-commune { background: #98FB98; color: #006400; }
    .rarity-badge.commune { background: #F0F8FF; color: #4682B4; }
    .rarity-badge.fr√©quente { background: #F5F5F5; color: #696969; }
    .rarity-badge.commun { background: #F5F5F5; color: #696969; }

    .card-footer {
      padding: 1rem;
      border-top: 1px solid var(--border-color);
      text-align: center;
      background: rgba(218, 165, 32, 0.05);
    }

    .btn-detail {
      padding: 0.5rem 1rem;
      border: 2px solid var(--primary-bg);
      background: var(--primary-bg);
      color: var(--text-light);
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-weight: bold;
      font-family: var(--font-ui);
    }

    .btn-detail:hover {
      background: var(--accent-gold);
      border-color: var(--accent-gold);
      color: var(--primary-dark);
    }

    .btn-sm {
      padding: 0.4rem 0.8rem;
      font-size: 0.8rem;
    }

    .btn-xs {
      padding: 0.3rem 0.6rem;
      font-size: 0.75rem;
    }

    /* Vue tableau */
    .results-table {
      width: 100%;
      border-collapse: collapse;
      font-family: var(--font-ui);
    }

    .results-table th {
      background: var(--primary-bg);
      color: var(--text-light);
      padding: 1rem;
      text-align: left;
      font-weight: bold;
      font-family: var(--font-title);
    }

    .results-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .results-table tr:hover {
      background: #f8f9fa;
    }

    /* Vue compacte */
    .compact-list {
      background: var(--content-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .compact-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border-color);
      transition: var(--transition);
    }

    .compact-item:hover {
      background: #f8f9fa;
    }

    .compact-main {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 1;
    }

    .compact-name {
      font-weight: bold;
      color: var(--primary-bg);
    }

    .compact-subtitle {
      color: var(--primary-dark);
      opacity: 0.7;
      font-style: italic;
    }

    .compact-value {
      font-weight: bold;
      color: var(--accent-gold);
    }

    /* √âtats vides */
    .empty-state {
      text-align: center;
      padding: 3rem;
      background: var(--content-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    .empty-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .loading-indicator {
      text-align: center;
      padding: 2rem;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--border-color);
      border-top: 4px solid var(--accent-gold);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Modal d√©taill√©e */
    .detail-grid {
      display: grid;
      gap: 1.5rem;
    }

    .detail-section {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: var(--border-radius);
      border-left: 4px solid var(--accent-gold);
    }

    .detail-section h4 {
      color: var(--primary-bg);
      margin-bottom: 1rem;
      font-family: var(--font-title);
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 0.25rem 0;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .color-indicator {
      padding: 0.25rem 0.5rem;
      background: var(--accent-gold);
      color: white;
      border-radius: 4px;
      font-size: 0.8rem;
    }

    /* Notifications */
    @keyframes slideInNotif {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOutNotif {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .filters-compact {
        grid-template-columns: 1fr;
      }

      .results-header {
        flex-direction: column;
        gap: 1rem;
      }

      .cards-grid {
        grid-template-columns: 1fr;
      }

      .advanced-grid {
        grid-template-columns: 1fr;
      }

      .view-controls {
        flex-direction: column;
      }

      .view-btn {
        border-right: none;
        border-bottom: 1px solid var(--border-color);
      }

      .view-btn:last-child {
        border-bottom: none;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .compact-main {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
    }
  </style>
</body>
</html>
