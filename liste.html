<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Liste Compl√®te</title>
  <meta name="description" content="Catalogue complet de toutes les monnaies et gemmes disponibles">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="content fade-in">
    <!-- En-t√™te de la page -->
    <header class="page-header">
      <h1>üìã LISTE COMPL√àTE üìã</h1>
      <p class="page-subtitle">Catalogue de toutes les monnaies et gemmes</p>
    </header>

    <!-- Contr√¥les principaux -->
    <section class="section">
      <div class="controls-header">
        <div class="controls-left">
          <h2>üîç Exploration du Catalogue</h2>
        </div>
        <div class="controls-right">
          <button onclick="exportCatalog()" class="btn-action btn-save">
            üíæ Exporter le Catalogue
          </button>
          <button onclick="printCatalog()" class="btn-action btn-load">
            üñ®Ô∏è Imprimer
          </button>
        </div>
      </div>
      
      <!-- Statistiques rapides -->
      <div class="quick-stats">
        <div class="stat-item">
          <span class="stat-number" id="totalItems">0</span>
          <span class="stat-label">Objets Totaux</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="totalMonnaies">0</span>
          <span class="stat-label">Monnaies</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="totalGemmes">0</span>
          <span class="stat-label">Gemmes</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="maxValue">0</span>
          <span class="stat-label">Valeur Max (PM)</span>
        </div>
      </div>
    </section>

    <!-- Filtres et recherche avanc√©e -->
    <section class="section">
      <h2>üéØ Filtres et Recherche</h2>
      
      <div class="advanced-filters">
        <div class="filter-row">
          <div class="filter-group">
            <label for="categoryFilter">Cat√©gorie:</label>
            <select id="categoryFilter" onchange="applyFilters()">
              <option value="">Toutes les cat√©gories</option>
              <option value="pieces">Monnaies M√©talliques</option>
              <option value="gemmes">Gemmes Pr√©cieuses</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="sortOrder">Tri par:</label>
            <select id="sortOrder" onchange="applyFilters()">
              <option value="value-desc">Valeur (D√©croissant)</option>
              <option value="value-asc">Valeur (Croissant)</option>
              <option value="name-asc">Nom (A-Z)</option>
              <option value="name-desc">Nom (Z-A)</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="valueRange">Plage de valeur:</label>
            <select id="valueRange" onchange="applyFilters()">
              <option value="">Toutes les valeurs</option>
              <option value="0-1">0 - 1 PM</option>
              <option value="1-10">1 - 10 PM</option>
              <option value="10-50">10 - 50 PM</option>
              <option value="50-100">50 - 100 PM</option>
              <option value="100+">100+ PM</option>
            </select>
          </div>
        </div>
        
        <div class="search-row">
          <div class="search-container">
            <input type="text" id="searchInput" class="search-input" 
                   placeholder="Rechercher par nom..." 
                   oninput="applyFilters()">
            <button onclick="clearFilters()" class="btn-action clear-btn">
              üóëÔ∏è Effacer les filtres
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Onglets du catalogue -->
    <section class="section">
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-button active" onclick="switchCatalogTab('all')" title="Voir tous les objets">
            üìã Catalogue Complet
          </button>
          <button class="tab-button" onclick="switchCatalogTab('pieces')" title="Monnaies uniquement">
            ü™ô Monnaies
          </button>
          <button class="tab-button" onclick="switchCatalogTab('gemmes')" title="Gemmes uniquement">
            üíé Gemmes
          </button>
          <button class="tab-button" onclick="switchCatalogTab('comparison')" title="Comparaison d√©taill√©e">
            ‚öñÔ∏è Comparaison
          </button>
        </div>

        <!-- Catalogue complet -->
        <div id="tab-all" class="tab-content active">
          <div class="tab-header">
            <h2>üìã Catalogue Complet</h2>
            <div class="tab-actions">
              <span class="results-count">Affichage de <span id="visibleCount">0</span> objets</span>
            </div>
          </div>
          
          <div class="table-container">
            <table id="catalogTable" class="inventory-table">
              <thead>
                <tr>
                  <th width="35%">Nom</th>
                  <th width="20%">Cat√©gorie</th>
                  <th width="20%">Valeur (PM)</th>
                  <th width="15%">Raret√©</th>
                  <th width="10%">Actions</th>
                </tr>
              </thead>
              <tbody id="catalogTableBody">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Monnaies uniquement -->
        <div id="tab-pieces" class="tab-content">
          <div class="tab-header">
            <h2>ü™ô Monnaies M√©talliques</h2>
            <div class="tab-actions">
              <span class="results-count">Total: <span id="piecesCount">0</span> monnaies</span>
            </div>
          </div>
          
          <div class="table-container">
            <table class="inventory-table">
              <thead>
                <tr>
                  <th width="40%">Nom</th>
                  <th width="25%">Valeur (PM)</th>
                  <th width="20%">Ratio √† l'Or</th>
                  <th width="15%">Utilisation</th>
                </tr>
              </thead>
              <tbody id="piecesTableBody">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Gemmes uniquement -->
        <div id="tab-gemmes" class="tab-content">
          <div class="tab-header">
            <h2>üíé Gemmes Pr√©cieuses</h2>
            <div class="tab-actions">
              <span class="results-count">Total: <span id="gemmesCount">0</span> gemmes</span>
            </div>
          </div>
          
          <div class="table-container">
            <table class="inventory-table">
              <thead>
                <tr>
                  <th width="35%">Nom</th>
                  <th width="25%">Valeur (PM)</th>
                  <th width="20%">Raret√©</th>
                  <th width="20%">Famille</th>
                </tr>
              </thead>
              <tbody id="gemmesTableBody">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Comparaison -->
        <div id="tab-comparison" class="tab-content">
          <div class="tab-header">
            <h2>‚öñÔ∏è Comparaison D√©taill√©e</h2>
            <div class="tab-actions">
              <button onclick="generateComparison()" class="btn-action btn-load">
                üìä G√©n√©rer Analyse
              </button>
            </div>
          </div>
          
          <!-- Graphiques et comparaisons -->
          <div class="comparison-container">
            <div class="comparison-section">
              <h3>üìà Distribution des Valeurs</h3>
              <div class="chart-container" id="valueDistribution">
                <!-- Graphique simple -->
              </div>
            </div>
            
            <div class="comparison-section">
              <h3>üèÜ Top 10 des Plus Pr√©cieux</h3>
              <div class="top-items" id="topItems">
                <!-- Liste des objets les plus pr√©cieux -->
              </div>
            </div>
            
            <div class="comparison-section">
              <h3>‚öñÔ∏è √âquivalences</h3>
              <div class="equivalences" id="equivalences">
                <!-- Tableau d'√©quivalences -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Informations d√©taill√©es -->
    <section class="section">
      <h2>üìä Analyse du Catalogue</h2>
      <div class="info-grid">
        <div class="info-card">
          <h3>ü™ô Monnaies M√©talliques</h3>
          <div id="statsMonnaies">
            <p>Nombre total: <span id="statMonnaiesCount">-</span></p>
            <p>Valeur moyenne: <span id="statMonnaiesAvg">-</span> PM</p>
            <p>Valeur m√©diane: <span id="statMonnaiesMedian">-</span> PM</p>
            <p>Plus pr√©cieuse: <span id="statMonnaiesMax">-</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>üíé Gemmes Pr√©cieuses</h3>
          <div id="statsGemmes">
            <p>Nombre total: <span id="statGemmesCount">-</span></p>
            <p>Valeur moyenne: <span id="statGemmesAvg">-</span> PM</p>
            <p>Valeur m√©diane: <span id="statGemmesMedian">-</span> PM</p>
            <p>Plus pr√©cieuse: <span id="statGemmesMax">-</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>üìà Distribution</h3>
          <div id="statsDistribution">
            <p>Objets < 1 PM: <span id="statLow">-</span></p>
            <p>Objets 1-10 PM: <span id="statMedium">-</span></p>
            <p>Objets 10-50 PM: <span id="statHigh">-</span></p>
            <p>Objets > 50 PM: <span id="statVeryHigh">-</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>üîç Utilisation</h3>
          <div id="statsUsage">
            <p>Filtres actifs: <span id="activeFilters">0</span></p>
            <p>R√©sultats visibles: <span id="visibleItems">-</span></p>
            <p>Derni√®re recherche: <span id="lastSearch">Aucune</span></p>
            <p>Export disponible: <span id="exportStatus">Oui</span></p>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal de d√©tails d'objet -->
    <div id="itemDetailModal" class="popin-overlay" onclick="closeItemDetail()">
      <div class="popin-content" onclick="event.stopPropagation()">
        <div class="popin-header">
          <h2 id="itemDetailName">D√©tails de l'Objet</h2>
          <button onclick="closeItemDetail()" class="popin-close">‚úï</button>
        </div>
        
        <div class="popin-form">
          <div class="item-detail-content" id="itemDetailContent">
            <!-- Contenu g√©n√©r√© dynamiquement -->
          </div>
          
          <div class="item-actions">
            <button onclick="addToPersonalInventory()" class="btn-action btn-add">
              ‚ûï Ajouter √† l'Inventaire
            </button>
            <button onclick="copyItemInfo()" class="btn-action btn-save">
              üìã Copier les Infos
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="script.js"></script>
  <script src="nav.js"></script>
  <script>
    // Variables globales pour la page Liste
    let currentCatalogTab = 'all';
    let filteredData = [];
    let allItems = [];

    // ===== INITIALISATION =====
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üìã Liste Compl√®te - Initialis√©');
      
      initializeData();
      populateAllTables();
      updateStatistics();
      applyFilters();
    });

    // ===== INITIALISATION DES DONN√âES =====
    function initializeData() {
      allItems = [];
      
      // Ajouter les monnaies
      Object.entries(window.monnaies.pieces).forEach(([name, value]) => {
        allItems.push({
          name: name,
          value: value,
          category: 'pieces',
          categoryLabel: 'Monnaie',
          rarity: getRarity(value),
          type: 'M√©tallique'
        });
      });
      
      // Ajouter les gemmes
      Object.entries(window.monnaies.gemmes).forEach(([name, value]) => {
        allItems.push({
          name: name,
          value: value,
          category: 'gemmes',
          categoryLabel: 'Gemme',
          rarity: getRarity(value),
          type: getGemFamily(name)
        });
      });
      
      filteredData = [...allItems];
    }

    // ===== GESTION DES ONGLETS =====
    function switchCatalogTab(tabName) {
      // D√©sactiver tous les onglets
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      // Activer l'onglet s√©lectionn√©
      const tabButton = document.querySelector(`[onclick="switchCatalogTab('${tabName}')"]`);
      const tabContent = document.getElementById(`tab-${tabName}`);
      
      if (tabButton && tabContent) {
        tabButton.classList.add('active');
        tabContent.classList.add('active');
        currentCatalogTab = tabName;
        
        if (tabName === 'comparison') {
          generateComparison();
        }
      }
    }

    // ===== POPULATION DES TABLEAUX =====
    function populateAllTables() {
      populateCatalogTable();
      populatePiecesTable();
      populateGemmesTable();
    }

    function populateCatalogTable() {
      const tbody = document.getElementById('catalogTableBody');
      tbody.innerHTML = '';
      
      filteredData.forEach(item => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td><strong>${item.name}</strong></td>
          <td><span class="category-badge ${item.category}">${item.categoryLabel}</span></td>
          <td>${item.value.toFixed(item.category === 'pieces' ? 4 : 2)}</td>
          <td><span class="rarity-badge ${item.rarity.toLowerCase()}">${item.rarity}</span></td>
          <td>
            <button onclick="showItemDetail('${item.name}', '${item.category}')" class="btn-action btn-load btn-small">
              üëÅÔ∏è
            </button>
          </td>
        `;
      });
      
      document.getElementById('visibleCount').textContent = filteredData.length;
    }

    function populatePiecesTable() {
      const tbody = document.getElementById('piecesTableBody');
      tbody.innerHTML = '';
      
      const goldValue = window.monnaies.pieces['Or'] || 1;
      const pieces = Object.entries(window.monnaies.pieces)
        .sort(([,a], [,b]) => b - a);
      
      pieces.forEach(([name, value]) => {
        const ratio = (value / goldValue).toFixed(2);
        const usage = getUsageFrequency(name);
        
        const row = tbody.insertRow();
        row.innerHTML = `
          <td><strong>${name}</strong></td>
          <td>${value.toFixed(4)}</td>
          <td>${ratio}√ó</td>
          <td><span class="usage-badge ${usage.toLowerCase()}">${usage}</span></td>
        `;
      });
      
      document.getElementById('piecesCount').textContent = pieces.length;
    }

    function populateGemmesTable() {
      const tbody = document.getElementById('gemmesTableBody');
      tbody.innerHTML = '';
      
      const gemmes = Object.entries(window.monnaies.gemmes)
        .sort(([,a], [,b]) => b - a);
      
      gemmes.forEach(([name, value]) => {
        const rarity = getRarity(value);
        const family = getGemFamily(name);
        
        const row = tbody.insertRow();
        row.innerHTML = `
          <td><strong>${name}</strong></td>
          <td>${value.toFixed(2)}</td>
          <td><span class="rarity-badge ${rarity.toLowerCase()}">${rarity}</span></td>
          <td><span class="family-badge">${family}</span></td>
        `;
      });
      
      document.getElementById('gemmesCount').textContent = gemmes.length;
    }

    // ===== SYST√àME DE FILTRES =====
    function applyFilters() {
      const categoryFilter = document.getElementById('categoryFilter').value;
      const sortOrder = document.getElementById('sortOrder').value;
      const valueRange = document.getElementById('valueRange').value;
      const searchQuery = document.getElementById('searchInput').value.toLowerCase();
      
      // Filtrer les donn√©es
      filteredData = allItems.filter(item => {
        // Filtre par cat√©gorie
        if (categoryFilter && item.category !== categoryFilter) return false;
        
        // Filtre par recherche
        if (searchQuery && !item.name.toLowerCase().includes(searchQuery)) return false;
        
        // Filtre par plage de valeur
        if (valueRange) {
          const [min, max] = valueRange.split('-').map(v => v === '' ? Infinity : parseFloat(v.replace('+', '')));
          if (valueRange.includes('+')) {
            if (item.value < min) return false;
          } else {
            if (item.value < min || item.value > max) return false;
          }
        }
        
        return true;
      });
      
      // Trier les donn√©es
      filteredData.sort((a, b) => {
        switch (sortOrder) {
          case 'value-desc': return b.value - a.value;
          case 'value-asc': return a.value - b.value;
          case 'name-asc': return a.name.localeCompare(b.name);
          case 'name-desc': return b.name.localeCompare(a.name);
          default: return 0;
        }
      });
      
      // Mettre √† jour l'affichage
      populateCatalogTable();
      updateFilterStatus();
    }

    function clearFilters() {
      document.getElementById('categoryFilter').value = '';
      document.getElementById('sortOrder').value = 'value-desc';
      document.getElementById('valueRange').value = '';
      document.getElementById('searchInput').value = '';
      
      applyFilters();
      showNotification('üóëÔ∏è Filtres effac√©s');
    }

    function updateFilterStatus() {
      const activeFilters = [
        document.getElementById('categoryFilter').value,
        document.getElementById('valueRange').value,
        document.getElementById('searchInput').value
      ].filter(v => v).length;
      
      document.getElementById('activeFilters').textContent = activeFilters;
      document.getElementById('visibleItems').textContent = filteredData.length;
      
      if (document.getElementById('searchInput').value) {
        document.getElementById('lastSearch').textContent = document.getElementById('searchInput').value;
      }
    }

    // ===== FONCTIONS UTILITAIRES =====
    function getRarity(value) {
      if (value > 50) return 'L√©gendaire';
      if (value > 10) return 'Rare';
      if (value > 5) return 'Peu commune';
      if (value > 1) return 'Commune';
      return 'Basique';
    }

    function getGemFamily(name) {
      const families = {
        'Rubis': 'Corindon', 'Saphir': 'Corindon',
        '√âmeraude': 'B√©ryl', 'Aigue-Marine': 'B√©ryl',
        'Diamant': 'Carbone', 'Am√©thyste': 'Quartz',
        'Citrine': 'Quartz', 'Quartz': 'Quartz',
        'Topaze': 'Silicate', 'Grenat': 'Silicate',
        'Turquoise': 'Phosphate', 'Lapis Lazuli': 'Silicate'
      };
      
      for (const [gem, family] of Object.entries(families)) {
        if (name.includes(gem)) return family;
      }
      return 'Autre';
    }

    function getUsageFrequency(name) {
      const common = ['Or', 'Argent', 'Cuivre'];
      const uncommon = ['Platine', '√âlectrum'];
      
      if (common.includes(name)) return 'Fr√©quent';
      if (uncommon.includes(name)) return 'Occasionnel';
      return 'Rare';
    }

    // ===== MODAL DE D√âTAILS =====
    function showItemDetail(name, category) {
      const item = allItems.find(i => i.name === name && i.category === category);
      if (!item) return;
      
      document.getElementById('itemDetailName').textContent = `D√©tails: ${name}`;
      
      const content = document.getElementById('itemDetailContent');
      content.innerHTML = `
        <div class="detail-grid">
          <div class="detail-section">
            <h4>Informations G√©n√©rales</h4>
            <p><strong>Nom:</strong> ${item.name}</p>
            <p><strong>Cat√©gorie:</strong> ${item.categoryLabel}</p>
            <p><strong>Type:</strong> ${item.type}</p>
            <p><strong>Raret√©:</strong> ${item.rarity}</p>
          </div>
          
          <div class="detail-section">
            <h4>Valeur et √âquivalences</h4>
            <p><strong>Valeur:</strong> ${item.value.toFixed(item.category === 'pieces' ? 4 : 2)} PM</p>
            <p><strong>En Or:</strong> ${(item.value / (window.monnaies.pieces['Or'] || 1)).toFixed(2)} pi√®ces</p>
            <p><strong>En Argent:</strong> ${(item.value / (window.monnaies.pieces['Argent'] || 1)).toFixed(2)} pi√®ces</p>
          </div>
          
          <div class="detail-section">
            <h4>Statistiques</h4>
            <p><strong>Rang par valeur:</strong> ${getRankByValue(item)} / ${allItems.length}</p>
            <p><strong>Percentile:</strong> ${getPercentile(item)}%</p>
            <p><strong>Usage recommand√©:</strong> ${getRecommendedUsage(item)}</p>
          </div>
        </div>
      `;
      
      document.getElementById('itemDetailModal').classList.add('active');
    }

    function closeItemDetail() {
      document.getElementById('itemDetailModal').classList.remove('active');
    }

    function getRankByValue(item) {
      const sorted = [...allItems].sort((a, b) => b.value - a.value);
      return sorted.findIndex(i => i.name === item.name && i.category === item.category) + 1;
    }

    function getPercentile(item) {
      const rank = getRankByValue(item);
      return Math.round((1 - rank / allItems.length) * 100);
    }

    function getRecommendedUsage(item) {
      if (item.value > 50) return 'Transactions importantes, objets magiques';
      if (item.value > 10) return 'Commerce de luxe, √©quipements rares';
      if (item.value > 1) return 'Commerce quotidien, services';
      return 'Petites transactions, monnaie d\'appoint';
    }

    // ===== COMPARAISON ET ANALYSE =====
    function generateComparison() {
      generateValueDistribution();
      generateTopItems();
      generateEquivalences();
    }

    function generateValueDistribution() {
      const container = document.getElementById('valueDistribution');
      const ranges = [
        { label: '0-1 PM', min: 0, max: 1, count: 0 },
        { label: '1-10 PM', min: 1, max: 10, count: 0 },
        { label: '10-50 PM', min: 10, max: 50, count: 0 },
        { label: '50+ PM', min: 50, max: Infinity, count: 0 }
      ];
      
      allItems.forEach(item => {
        ranges.forEach(range => {
          if (item.value >= range.min && item.value < range.max) {
            range.count++;
          }
        });
      });
      
      const maxCount = Math.max(...ranges.map(r => r.count));
      
      container.innerHTML = ranges.map(range => `
        <div class="chart-bar">
          <div class="bar-label">${range.label}</div>
          <div class="bar-container">
            <div class="bar-fill" style="width: ${(range.count / maxCount) * 100}%"></div>
            <span class="bar-value">${range.count}</span>
          </div>
        </div>
      `).join('');
    }

    function generateTopItems() {
      const container = document.getElementById('topItems');
      const top10 = [...allItems]
        .sort((a, b) => b.value - a.value)
        .slice(0, 10);
      
      container.innerHTML = top10.map((item, index) => `
        <div class="top-item">
          <span class="rank">#${index + 1}</span>
          <span class="name">${item.name}</span>
          <span class="category-badge ${item.category}">${item.categoryLabel}</span>
          <span class="value">${item.value.toFixed(2)} PM</span>
        </div>
      `).join('');
    }

    function generateEquivalences() {
      const container = document.getElementById('equivalences');
      const baseValue = 100; // 100 PM de r√©f√©rence
      
      const equivalences = allItems
        .filter(item => item.value > 0)
        .map(item => ({
          name: item.name,
          category: item.category,
          quantity: (baseValue / item.value).toFixed(2)
        }))
        .sort((a, b) => parseFloat(b.quantity) - parseFloat(a.quantity))
        .slice(0, 8);
      
      container.innerHTML = `
        <h4>√âquivalence de ${baseValue} PM:</h4>
        <div class="equivalence-grid">
          ${equivalences.map(eq => `
            <div class="equivalence-item">
              <span class="eq-quantity">${eq.quantity}</span>
              <span class="eq-name">${eq.name}</span>
            </div>
          `).join('')}
        </div>
      `;
    }

    // ===== FONCTIONS D'EXPORT =====
    function exportCatalog() {
      const data = {
        catalog: allItems,
        exportDate: new Date().toISOString(),
        version: '1.0',
        totalItems: allItems.length
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.style.display = 'none';
      a.href = url;
      a.download = `catalogue_complet_${new Date().toISOString().slice(0, 10)}.json`;
      
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('üíæ Catalogue export√© avec succ√®s');
    }

    function printCatalog() {
      window.print();
    }

    function addToPersonalInventory() {
      showNotification('‚ûï Fonctionnalit√© en d√©veloppement');
    }

    function copyItemInfo() {
      showNotification('üìã Informations copi√©es');
    }

    // ===== STATISTIQUES =====
    function updateStatistics() {
      const pieces = allItems.filter(item => item.category === 'pieces');
      const gemmes = allItems.filter(item => item.category === 'gemmes');
      
      // Statistiques g√©n√©rales
      document.getElementById('totalItems').textContent = allItems.length;
      document.getElementById('totalMonnaies').textContent = pieces.length;
      document.getElementById('totalGemmes').textContent = gemmes.length;
      document.getElementById('maxValue').textContent = Math.max(...allItems.map(i => i.value)).toFixed(2);
      
      // Statistiques des monnaies
      const piecesValues = pieces.map(p => p.value);
      document.getElementById('statMonnaiesCount').textContent = pieces.length;
      document.getElementById('statMonnaiesAvg').textContent = (piecesValues.reduce((a, b) => a + b, 0) / piecesValues.length).toFixed(4);
      document.getElementById('statMonnaiesMedian').textContent = getMedian(piecesValues).toFixed(4);
      
      const maxPiece = pieces.reduce((max, p) => p.value > max.value ? p : max, pieces[0]);
      document.getElementById('statMonnaiesMax').textContent = maxPiece ? maxPiece.name : '-';
      
      // Statistiques des gemmes
      const gemmesValues = gemmes.map(g => g.value);
      document.getElementById('statGemmesCount').textContent = gemmes.length;
      document.getElementById('statGemmesAvg').textContent = (gemmesValues.reduce((a, b) => a + b, 0) / gemmesValues.length).toFixed(2);
      document.getElementById('statGemmesMedian').textContent = getMedian(gemmesValues).toFixed(2);
      
      const maxGemme = gemmes.reduce((max, g) => g.value > max.value ? g : max, gemmes[0]);
      document.getElementById('statGemmesMax').textContent = maxGemme ? maxGemme.name : '-';
      
      // Distribution par valeur
      const allValues = allItems.map(i => i.value);
      document.getElementById('statLow').textContent = allValues.filter(v => v < 1).length;
      document.getElementById('statMedium').textContent = allValues.filter(v => v >= 1 && v < 10).length;
      document.getElementById('statHigh').textContent = allValues.filter(v => v >= 10 && v < 50).length;
      document.getElementById('statVeryHigh').textContent = allValues.filter(v => v >= 50).length;
      
      // Statut d'utilisation
      document.getElementById('visibleItems').textContent = filteredData.length;
      document.getElementById('exportStatus').textContent = 'Disponible';
    }

    function getMedian(values) {
      const sorted = [...values].sort((a, b) => a - b);
      const mid = Math.floor(sorted.length / 2);
      return sorted.length % 2 === 0 
        ? (sorted[mid - 1] + sorted[mid]) / 2 
        : sorted[mid];
    }

    // ===== NOTIFICATIONS =====
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 10000;
        background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);
        color: white; padding: 15px 25px; border-radius: 8px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        font-family: "Quattrocento Sans", Arial, sans-serif;
        font-weight: bold; font-size: 14px;
        border: 2px solid #228B22;
        animation: slideIn 0.3s ease;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // ===== EXPOSITION DES FONCTIONS =====
    window.switchCatalogTab = switchCatalogTab;
    window.applyFilters = applyFilters;
    window.clearFilters = clearFilters;
    window.showItemDetail = showItemDetail;
    window.closeItemDetail = closeItemDetail;
    window.generateComparison = generateComparison;
    window.exportCatalog = exportCatalog;
    window.printCatalog = printCatalog;
    window.addToPersonalInventory = addToPersonalInventory;
    window.copyItemInfo = copyItemInfo;
  </script>

  <!-- Styles suppl√©mentaires pour la liste -->
  <style>
    /* Statistiques rapides */
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .stat-item {
      background: linear-gradient(135deg, var(--accent-gold) 0%, #F4E07A 100%);
      padding: 15px;
      border-radius: var(--border-radius);
      text-align: center;
      border: 2px solid var(--accent-gold);
      color: var(--primary-dark);
    }

    .stat-number {
      display: block;
      font-size: 1.8rem;
      font-weight: bold;
      font-family: var(--font-title);
    }

    .stat-label {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.8;
    }

    /* Filtres avanc√©s */
    .advanced-filters {
      background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--content-bg) 100%);
      padding: 25px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
    }

    .filter-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .search-row {
      display: flex;
      gap: 15px;
      align-items: end;
    }

    .search-container {
      flex: 1;
      display: flex;
      gap: 15px;
      align-items: end;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
    }

    .filter-group label {
      margin-bottom: 8px;
      font-family: var(--font-title);
      color: var(--primary-dark);
      font-size: 0.9rem;
    }

    /* Badges et indicateurs */
    .category-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .category-badge.pieces {
      background: #FFE4B5;
      color: #8B4513;
    }

    .category-badge.gemmes {
      background: #E6E6FA;
      color: #4B0082;
    }

    .rarity-badge {
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: bold;
      text-transform: uppercase;
    }

    .rarity-badge.l√©gendaire { background: #FFD700; color: #8B4513; }
    .rarity-badge.rare { background: #DDA0DD; color: #4B0082; }
    .rarity-badge.peu.commune { background: #98FB98; color: #006400; }
    .rarity-badge.commune { background: #F0F8FF; color: #4682B4; }
    .rarity-badge.basique { background: #F5F5F5; color: #696969; }

    .usage-badge {
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: bold;
    }

    .usage-badge.fr√©quent { background: #90EE90; color: #006400; }
    .usage-badge.occasionnel { background: #FFE4B5; color: #FF8C00; }
    .usage-badge.rare { background: #FFB6C1; color: #DC143C; }

    .family-badge {
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 0.7rem;
      background: #F0F8FF;
      color: #4682B4;
      font-weight: bold;
    }

    /* Boutons petits */
    .btn-small {
      padding: 6px 10px;
      font-size: 0.8rem;
      min-height: 32px;
    }

    /* R√©sultats et compteurs */
    .results-count {
      font-style: italic;
      color: var(--primary-dark);
      font-family: var(--font-ui);
    }

    /* Comparaison et graphiques */
    .comparison-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
    }

    .comparison-section {
      background: var(--content-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow);
    }

    .comparison-section h3 {
      margin-top: 0;
      color: var(--primary-bg);
      border-bottom: 2px solid var(--accent-gold);
      padding-bottom: 10px;
    }

    /* Graphique simple */
    .chart-container {
      margin-top: 15px;
    }

    .chart-bar {
      margin: 10px 0;
    }

    .bar-label {
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--primary-dark);
    }

    .bar-container {
      position: relative;
      height: 25px;
      background: #f0f0f0;
      border-radius: 4px;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-gold) 0%, #F4E07A 100%);
      transition: width 0.5s ease;
    }

    .bar-value {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-weight: bold;
      color: var(--primary-dark);
      font-size: 0.8rem;
    }

    /* Top items */
    .top-items {
      margin-top: 15px;
    }

    .top-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      margin: 5px 0;
      background: #f8f8f8;
      border-radius: 6px;
      border-left: 3px solid var(--accent-gold);
    }

    .top-item .rank {
      font-weight: bold;
      color: var(--accent-gold);
      min-width: 30px;
    }

    .top-item .name {
      flex: 1;
      font-weight: bold;
      color: var(--primary-dark);
    }

    .top-item .value {
      font-weight: bold;
      color: var(--primary-bg);
    }

    /* √âquivalences */
    .equivalence-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    .equivalence-item {
      text-align: center;
      padding: 10px;
      background: #f8f8f8;
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }

    .eq-quantity {
      display: block;
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--accent-gold);
    }

    .eq-name {
      display: block;
      font-size: 0.8rem;
      color: var(--primary-dark);
      margin-top: 5px;
    }

    /* Modal de d√©tails */
    .detail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .detail-section {
      background: #f8f8f8;
      padding: 15px;
      border-radius: var(--border-radius);
      border-left: 3px solid var(--accent-gold);
    }

    .detail-section h4 {
      margin-top: 0;
      color: var(--primary-bg);
      font-family: var(--font-title);
    }

    .detail-section p {
      margin: 8px 0;
      font-size: 0.9rem;
    }

    .item-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 25px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .quick-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .filter-row {
        grid-template-columns: 1fr;
      }
      
      .search-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-container {
        flex-direction: column;
      }
      
      .comparison-container {
        grid-template-columns: 1fr;
      }
      
      .equivalence-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .detail-grid {
        grid-template-columns: 1fr;
      }
      
      .item-actions {
        flex-direction: column;
      }
    }

    /* Animation pour les notifications */
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
  </style>
</body>
</html>
