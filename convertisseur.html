<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Convertisseur Monetarum</title>
  <meta name="description" content="Convertisseur monetarum et gemmarum">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="content fade-in">
    <!-- En-t√™te de la page -->
    <header class="page-header">
      <h1>üîÑ CONVERTISSEUR MONETARUM üîÑ</h1>
      <p class="page-subtitle">Transformatio inter diversas monetas et gemmas</p>
    </header>

    <!-- Contr√¥les principaux -->
    <section class="section">
      <div class="controls-header">
        <div class="controls-left">
          <h2>‚öñÔ∏è Conversio Instantanea</h2>
        </div>
        <div class="controls-right">
          <button onclick="resetConverter()" class="btn-action btn-delete">
            üóëÔ∏è Reinitializare
          </button>
        </div>
      </div>

      <!-- Formulaire de conversion -->
      <div class="conversion-form">
        <div class="input-group">
          <label for="convCurrency">Moneta/Gemma selecta:</label>
          <select id="convCurrency" onchange="convertAll()">
            <!-- Options g√©n√©r√©es dynamiquement -->
          </select>
        </div>
        
        <div class="input-group">
          <label for="convQty">Quantitas:</label>
          <input type="number" id="convQty" value="1" min="0" step="0.01" oninput="convertAll()">
        </div>
      </div>
    </section>

    <!-- R√©sultats de conversion -->
    <section class="section">
      <h2>üìä Resultata Conversionis</h2>
      
      <!-- Conversion vers monnaies de base -->
      <div class="conversion-results">
        <h3>ü™ô Conversio ad Monetas Principales</h3>
        <div class="table-container">
          <table id="convResultsTable" class="inventory-table">
            <thead>
              <tr>
                <th width="40%">Denominatio</th>
                <th width="30%">Valor Unitarius</th>
                <th width="30%">Aequivalens</th>
              </tr>
            </thead>
            <tbody id="convResults">
              <!-- R√©sultats g√©n√©r√©s dynamiquement -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Informations sur la devise s√©lectionn√©e -->
      <div class="currency-info" id="currencyInfo">
        <h3>‚ÑπÔ∏è Informationes de Moneta Selecta</h3>
        <div class="info-content">
          <p><strong>Nomen:</strong> <span id="selectedName">-</span></p>
          <p><strong>Categoria:</strong> <span id="selectedCategory">-</span></p>
          <p><strong>Valor in PM:</strong> <span id="selectedValue">-</span></p>
          <p><strong>Raritas:</strong> <span id="selectedRarity">-</span></p>
        </div>
      </div>
    </section>

    <!-- Tableaux de r√©f√©rence -->
    <section class="section">
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-button active" onclick="switchReferenceTab('pieces')" title="Monetae metallicae">
            ü™ô Monetae
          </button>
          <button class="tab-button" onclick="switchReferenceTab('gemmes')" title="Gemmae pretiosae">
            üíé Gemmae
          </button>
        </div>

        <!-- Tableau des pi√®ces -->
        <div id="ref-pieces" class="tab-content active">
          <div class="tab-header">
            <h2>ü™ô Monetae Metallicae - Tabula Referentiae</h2>
          </div>
          
          <div class="table-container">
            <table class="inventory-table">
              <thead>
                <tr>
                  <th width="50%">Nomen</th>
                  <th width="25%">Valor (PM)</th>
                  <th width="25%">Ratio ad Aurum</th>
                </tr>
              </thead>
              <tbody id="piecesReference">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tableau des gemmes -->
        <div id="ref-gemmes" class="tab-content">
          <div class="tab-header">
            <h2>üíé Gemmae Pretiosae - Tabula Referentiae</h2>
          </div>
          
          <div class="table-container">
            <table class="inventory-table">
              <thead>
                <tr>
                  <th width="50%">Nomen</th>
                  <th width="25%">Valor (PM)</th>
                  <th width="25%">Raritas</th>
                </tr>
              </thead>
              <tbody id="gemmesReference">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Calculateur avanc√© -->
    <section class="section">
      <h2>üßÆ Calculator Advanc√©</h2>
      <div class="advanced-calculator">
        <div class="calc-input">
          <label for="calcFrom">De:</label>
          <select id="calcFrom" onchange="advancedCalculation()">
            <!-- Options g√©n√©r√©es dynamiquement -->
          </select>
          <input type="number" id="calcFromQty" value="1" min="0" step="0.01" oninput="advancedCalculation()">
        </div>
        
        <div class="calc-arrow">‚áÑ</div>
        
        <div class="calc-input">
          <label for="calcTo">Ad:</label>
          <select id="calcTo" onchange="advancedCalculation()">
            <!-- Options g√©n√©r√©es dynamiquement -->
          </select>
          <input type="number" id="calcToQty" readonly>
        </div>
      </div>
      
      <div class="calc-result" id="calcResult">
        <p>Selecte monetas pro calculatione...</p>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="nav.js"></script>
  <script>
    // Variables globales
    let currentReferenceTab = 'pieces';

    // ===== INITIALISATION =====
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üîÑ Convertisseur Monetarum - Initialis√©');
      
      populateSelects();
      populateReferenceTables();
      convertAll();
    });

    // ===== POPULATION DES SELECTS =====
    function populateSelects() {
      const selects = ['convCurrency', 'calcFrom', 'calcTo'];
      
      selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (!select) return;
        
        select.innerHTML = '';
        
        // Ajouter les pi√®ces
        const piecesGroup = document.createElement('optgroup');
        piecesGroup.label = 'Monetae Metallicae';
        
        Object.keys(window.monnaies.pieces).forEach(nom => {
          const option = document.createElement('option');
          option.value = nom;
          option.textContent = nom;
          option.dataset.category = 'pieces';
          piecesGroup.appendChild(option);
        });
        
        select.appendChild(piecesGroup);
        
        // Ajouter les gemmes
        const gemmesGroup = document.createElement('optgroup');
        gemmesGroup.label = 'Gemmae Pretiosae';
        
        Object.keys(window.monnaies.gemmes).forEach(nom => {
          const option = document.createElement('option');
          option.value = nom;
          option.textContent = nom;
          option.dataset.category = 'gemmes';
          gemmesGroup.appendChild(option);
        });
        
        select.appendChild(gemmesGroup);
      });
    }

    // ===== CONVERSION PRINCIPALE =====
    function convertAll() {
      const select = document.getElementById('convCurrency');
      const qtyInput = document.getElementById('convQty');
      const tbody = document.getElementById('convResults');
      
      if (!select || !qtyInput || !tbody) return;
      
      const selectedCurrency = select.value;
      const quantity = parseFloat(qtyInput.value) || 0;
      
      if (!selectedCurrency) {
        tbody.innerHTML = '<tr><td colspan="3">Selecte monetam...</td></tr>';
        return;
      }
      
      // Obtenir la valeur de base
      let baseValue = 0;
      let category = '';
      
      if (window.monnaies.pieces[selectedCurrency] !== undefined) {
        baseValue = window.monnaies.pieces[selectedCurrency] * quantity;
        category = 'Monetae';
      } else if (window.monnaies.gemmes[selectedCurrency] !== undefined) {
        baseValue = window.monnaies.gemmes[selectedCurrency] * quantity;
        category = 'Gemmae';
      }
      
      // Conversion vers les monnaies principales
      tbody.innerHTML = '';
      
      const mainCurrencies = ['Fer', 'Argent', 'Or', '√âlectrum', 'Platine'];
      
      mainCurrencies.forEach(currency => {
        const value = window.monnaies.pieces[currency] || 1;
        const equivalent = baseValue / value;
        
        const row = tbody.insertRow();
        row.innerHTML = `
          <td><strong>${currency}</strong></td>
          <td>${value.toFixed(4)} PM</td>
          <td>${equivalent.toFixed(2)}</td>
        `;
        
        if (currency === selectedCurrency) {
          row.style.backgroundColor = 'rgba(218, 165, 32, 0.2)';
          row.style.fontWeight = 'bold';
        }
      });
      
      // Mettre √† jour les informations sur la devise
      updateCurrencyInfo(selectedCurrency, category, baseValue / quantity);
    }

    // ===== INFORMATIONS SUR LA DEVISE =====
    function updateCurrencyInfo(name, category, value) {
      document.getElementById('selectedName').textContent = name;
      document.getElementById('selectedCategory').textContent = category;
      document.getElementById('selectedValue').textContent = value.toFixed(4) + ' PM';
      
      // Calculer la raret√© en latin
      let rarity = 'Communis';
      if (value > 50) rarity = 'Rarissima';
      else if (value > 10) rarity = 'Rara';
      else if (value > 5) rarity = 'Mediocris';
      else if (value > 1) rarity = 'Frequens';
      
      document.getElementById('selectedRarity').textContent = rarity;
    }

    // ===== GESTION DES ONGLETS DE R√âF√âRENCE =====
    function switchReferenceTab(tabName) {
      // D√©sactiver tous les onglets
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      // Activer l'onglet s√©lectionn√©
      const tabButton = document.querySelector(`[onclick="switchReferenceTab('${tabName}')"]`);
      const tabContent = document.getElementById(`ref-${tabName}`);
      
      if (tabButton && tabContent) {
        tabButton.classList.add('active');
        tabContent.classList.add('active');
        currentReferenceTab = tabName;
      }
    }

    // ===== TABLEAUX DE R√âF√âRENCE =====
    function populateReferenceTables() {
      // Table des pi√®ces
      const piecesTable = document.getElementById('piecesReference');
      if (piecesTable) {
        const orValue = window.monnaies.pieces['Or'] || 1;
        
        Object.entries(window.monnaies.pieces)
          .sort(([,a], [,b]) => b - a)
          .forEach(([nom, valeur]) => {
            const ratio = (valeur / orValue).toFixed(2);
            const row = piecesTable.insertRow();
            row.innerHTML = `
              <td><strong>${nom}</strong></td>
              <td>${valeur.toFixed(4)}</td>
              <td>${ratio}√ó</td>
            `;
          });
      }
      
      // Table des gemmes
      const gemmesTable = document.getElementById('gemmesReference');
      if (gemmesTable) {
        Object.entries(window.monnaies.gemmes)
          .sort(([,a], [,b]) => b - a)
          .forEach(([nom, valeur]) => {
            let rarity = 'Communis';
            if (valeur > 50) rarity = 'Rarissima';
            else if (valeur > 10) rarity = 'Rara';
            else if (valeur > 5) rarity = 'Mediocris';
            else if (valeur > 1) rarity = 'Frequens';
            
            const row = gemmesTable.insertRow();
            row.innerHTML = `
              <td><strong>${nom}</strong></td>
              <td>${valeur.toFixed(2)}</td>
              <td>${rarity}</td>
            `;
          });
      }
    }

    // ===== CALCULATEUR AVANC√â =====
    function advancedCalculation() {
      const fromSelect = document.getElementById('calcFrom');
      const toSelect = document.getElementById('calcTo');
      const fromQty = document.getElementById('calcFromQty');
      const toQty = document.getElementById('calcToQty');
      const resultDiv = document.getElementById('calcResult');
      
      if (!fromSelect.value || !toSelect.value) {
        resultDiv.innerHTML = '<p>Selecte ambas monetas...</p>';
        return;
      }
      
      const fromValue = getItemValue(fromSelect.
