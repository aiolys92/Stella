<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventaire Guilde</title>
  <meta name="description" content="Inventaire commun de la guilde - Gestion du tr√©sor collectif">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="content fade-in">
    <!-- En-t√™te de la page -->
    <header class="page-header">
      <h1>‚öîÔ∏è INVENTAIRE GUILDE ‚öîÔ∏è</h1>
      <p class="page-subtitle">Tr√©sor commun de la confr√©rie</p>
    </header>

    <!-- Contr√¥les principaux -->
    <section class="section">
      <div class="controls-header">
        <div class="controls-left">
          <h2>üí∞ Gestion du Tr√©sor Commun</h2>
        </div>
        <div class="controls-right">
          <input type="file" accept=".json" id="fileInputInventory" style="display: none;">
          <button onclick="document.getElementById('fileInputInventory').click()" class="btn-action btn-load">
            üìÇ Importer
          </button>
          <button id="saveInventoryBtn" class="btn-action btn-save">
            üíæ Sauvegarder
          </button>
        </div>
      </div>
      
      <!-- Affichage du total -->
      <div class="total-display">
        <span class="total-label">Valeur Totale Guilde:</span>
        <span id="totalPieces" class="total-value">0</span>
        <span class="total-unit">PM</span>
      </div>
    </section>

    <!-- Onglets des inventaires -->
    <section class="section">
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-button active" onclick="switchInventoryTab('pieces')" title="Monnaies m√©talliques de la guilde">
            ü™ô Monnaies
          </button>
          <button class="tab-button" onclick="switchInventoryTab('gemmes')" title="Gemmes pr√©cieuses de la guilde">
            üíé Gemmes
          </button>
          <button class="tab-button" onclick="switchInventoryTab('distribution')" title="Distribution entre les membres">
            üìä Distribution
          </button>
        </div>

        <!-- Inventaire des Pi√®ces -->
        <div id="tab-pieces" class="tab-content active">
          <div class="tab-header">
            <h2>ü™ô Monnaies M√©talliques de la Guilde</h2>
            <div class="tab-actions">
              <button onclick="addInventaireRow('pieces')" class="btn-action btn-add">
                ‚ûï Ajouter une monnaie
              </button>
              <button onclick="transferFromPersonal('pieces')" class="btn-action btn-transfer">
                üì§ Transfer depuis personnel
              </button>
              <button onclick="distributeToMembers('pieces')" class="btn-action btn-load">
                üìä Distribuer aux Membres
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="inventaireTablePieces" class="inventory-table">
              <thead>
                <tr>
                  <th width="25%">Nom</th>
                  <th width="15%">Quantit√©</th>
                  <th width="15%">Valeur Unitaire</th>
                  <th width="15%">Valeur Totale</th>
                  <th width="15%">Contribution</th>
                  <th width="15%">Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Lignes g√©n√©r√©es dynamiquement -->
              </tbody>
            </table>
            
            <!-- Section de distribution pour les pi√®ces -->
            <div id="distributionPieces" class="distribution-section" style="display: none;">
              <h3>üìä Distribution des Monnaies</h3>
              <div class="distribution-results">
                <div class="results-grid" id="distributionGridPieces">
                  <!-- G√©n√©r√© dynamiquement -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Inventaire des Gemmes -->
        <div id="tab-gemmes" class="tab-content">
          <div class="tab-header">
            <h2>üíé Gemmes Pr√©cieuses de la Guilde</h2>
            <div class="tab-actions">
              <button onclick="addInventaireRow('gemmes')" class="btn-action btn-add">
                ‚ûï Ajouter une gemme
              </button>
              <button onclick="transferFromPersonal('gemmes')" class="btn-action btn-transfer">
                üì§ Transfer depuis personnel
              </button>
              <button onclick="distributeToMembers('gemmes')" class="btn-action btn-load">
                üìä Distribuer aux Membres
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="inventaireTableGemmes" class="inventory-table">
              <thead>
                <tr>
                  <th width="25%">Nom</th>
                  <th width="15%">Quantit√©</th>
                  <th width="15%">Valeur Unitaire</th>
                  <th width="15%">Valeur Totale</th>
                  <th width="15%">Contribution</th>
                  <th width="15%">Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Lignes g√©n√©r√©es dynamiquement -->
              </tbody>
            </table>
            
            <!-- Section de distribution pour les gemmes -->
            <div id="distributionGemmes" class="distribution-section" style="display: none;">
              <h3>üìä Distribution des Gemmes</h3>
              <div class="distribution-results">
                <div class="results-grid" id="distributionGridGemmes">
                  <!-- G√©n√©r√© dynamiquement -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Onglet Distribution -->
        <div id="tab-distribution" class="tab-content">
          <div class="tab-header">
            <h2>üìä Distribution du Tr√©sor</h2>
            <div class="tab-actions">
              <button onclick="openContributionModal()" class="btn-action btn-add">
                üìù Gestion des Membres
              </button>
            </div>
          </div>
          
          <!-- Configuration de la distribution -->
          <div class="distribution-config">
            <h3>‚öôÔ∏è Configuration des Membres</h3>
            <div class="config-form">
              <div class="input-group">
                <label for="memberCount">Nombre de Membres:</label>
                <input type="number" id="memberCount" value="4" min="1" max="20" onchange="updateAllDistributions()">
              </div>
              <div class="members-preview">
                <h4>Membres Actuels:</h4>
                <div id="membersPreview">
                  <!-- Liste des membres -->
                </div>
              </div>
            </div>
          </div>

          <!-- R√©sultats de distribution g√©n√©rale -->
          <div class="distribution-results">
            <h3>üìà Distribution Totale du Tr√©sor</h3>
            <div class="total-distribution">
              <div class="total-summary">
                <p><strong>Valeur totale √† distribuer:</strong> <span id="totalToDistribute">0</span> PM</p>
                <p><strong>Par membre (√©gal):</strong> <span id="perMemberTotal">0</span> PM</p>
              </div>
              <div class="results-grid" id="distributionGridTotal">
                <!-- G√©n√©r√© dynamiquement -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Liste des objets par cat√©gories - CONSULTATION SEULEMENT -->
    <section class="section">
      <h2>üìã Liste de Toutes les Monnaies et Gemmes</h2>
      <p class="section-subtitle"><em>Consultation seulement - Aucune action de suppression</em></p>
      
      <!-- Filtres et recherche -->
      <div class="filters-row">
        <div class="filter-group">
          <label for="categoryFilter">Cat√©gorie:</label>
          <select id="categoryFilter" onchange="filtrerParCategorie(this.value)">
            <option value="">Toutes les cat√©gories</option>
            <option value="pieces">Monnaies</option>
            <option value="gemmes">Gemmes</option>
          </select>
        </div>
        
        <div class="search-group">
          <label for="searchObjects">Rechercher:</label>
          <input type="text" id="searchObjects" placeholder="Nom de l'objet..." 
                 oninput="rechercherObjets(this.value)">
        </div>
      </div>
      
      <!-- Conteneur des cat√©gories - LECTURE SEULE -->
      <div class="categories-container" id="categoriesContainer">
        <div class="category-section">
          <h3>ü™ô Monnaies M√©talliques</h3>
          <div class="table-container">
            <table class="inventory-table">
              <thead>
                <tr>
                  <th width="60%">Nom</th>
                  <th width="40%">Valeur (PM)</th>
                </tr>
              </thead>
              <tbody id="listMonetae">
                <!-- G√©n√©r√© par JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="category-section">
          <h3>üíé Gemmes Pr√©cieuses</h3>
          <div class="table-container">
            <table class="inventory-table">
              <thead>
                <tr>
                  <th width="60%">Nom</th>
                  <th width="40%">Valeur (PM)</th>
                </tr>
              </thead>
              <tbody id="listGemmae">
                <!-- G√©n√©r√© par JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Informations sur le tr√©sor de guilde -->
    <section class="section">
      <h2>üìä Statistiques du Tr√©sor de Guilde</h2>
      <div class="info-grid">
        <div class="info-card">
          <h3>ü™ô √âtat des Monnaies</h3>
          <div id="statsMonetae">
            <p>Types disponibles: <span id="countMonetae">-</span></p>
            <p>Valeur moyenne: <span id="avgMonetae">-</span> PM</p>
            <p>Valeur maximale: <span id="maxMonetae">-</span> PM</p>
            <p>Pourcentage du total: <span id="percentMonetae">0%</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>üíé √âtat des Gemmes</h3>
          <div id="statsGemmae">
            <p>Types disponibles: <span id="countGemmae">-</span></p>
            <p>Valeur moyenne: <span id="avgGemmae">-</span> PM</p>
            <p>Valeur maximale: <span id="maxGemmae">-</span> PM</p>
            <p>Pourcentage du total: <span id="percentGemmae">0%</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>‚öñÔ∏è Total du Tr√©sor</h3>
          <div id="statsTotal">
            <p>Objets totaux: <span id="countTotal">0</span></p>
            <p>Valeur totale: <span id="valueTotal">0</span> PM</p>
            <p>√âtat de la guilde: <span id="statusTotal">Vide</span></p>
            <p>Par membre: <span id="perMember">0</span> PM</p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>üìà Gestion de Guilde</h3>
          <div id="statsGuild">
            <p>Membres actifs: <span id="activeMembers">4</span></p>
            <p>Derni√®re contribution: <span id="lastContribution">Jamais</span></p>
            <p>Croissance: <span id="growth">+0%</span> (mois)</p>
            <p>Stabilit√©: <span id="stability">Stable</span></p>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal pour les contributions -->
    <div id="contributionModal" class="popin-overlay" onclick="closeContributionModal()">
      <div class="popin-content" onclick="event.stopPropagation()">
        <div class="popin-header">
          <h2>üìù Gestion des Membres</h2>
          <button onclick="closeContributionModal()" class="popin-close">‚úï</button>
        </div>
        
        <div class="popin-form">
          <h3>Membres de la Guilde</h3>
          <div id="membersList">
            <!-- G√©n√©r√© dynamiquement -->
          </div>
          
          <div class="form-field">
            <button onclick="addNewMember()" class="btn-action btn-add">
              ‚ûï Ajouter un Membre
            </button>
            <button onclick="saveContributions()" class="btn-action btn-save">
              üíæ Sauvegarder les Membres
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="script.js"></script>
  <script src="nav.js"></script>
  <script>
    // Variables globales pour la page Guilde
    let currentInventoryTab = 'pieces';
    let guildMembers = [
      { name: 'Dorusis', contribution: 25, class: 'Guerrier' },
      { name: 'Mage Aurelius', contribution: 30, class: 'Mage' },
      { name: 'Voleur Shadow', contribution: 20, class: 'Voleur' },
      { name: 'Pr√™tre Benedictus', contribution: 25, class: 'Pr√™tre' }
    ];

    // ===== GESTION DES ONGLETS D'INVENTAIRE =====
    function switchInventoryTab(tabName) {
      // D√©sactiver tous les onglets
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      // Activer l'onglet s√©lectionn√©
      const tabButton = document.querySelector(`[onclick="switchInventoryTab('${tabName}')"]`);
      const tabContent = document.getElementById(`tab-${tabName}`);
      
      if (tabButton && tabContent) {
        tabButton.classList.add('active');
        tabContent.classList.add('active');
        currentInventoryTab = tabName;
        
        if (tabName === 'distribution') {
          updateAllDistributions();
          updateMembersPreview();
        }
      }
    }

    // ===== DISTRIBUTION DANS LES ONGLETS MONNAIES/GEMMES =====
    function distributeToMembers(type) {
      const distributionSection = document.getElementById(`distribution${type.charAt(0).toUpperCase() + type.slice(1)}`);
      const grid = document.getElementById(`distributionGrid${type.charAt(0).toUpperCase() + type.slice(1)}`);
      
      if (distributionSection.style.display === 'none') {
        // Afficher la distribution
        distributionSection.style.display = 'block';
        calculateDistributionForType(type);
        showNotification(`üìä Distribution des ${type} calcul√©e`);
      } else {
        // Masquer la distribution
        distributionSection.style.display = 'none';
      }
    }

    function calculateDistributionForType(type) {
      const grid = document.getElementById(`distributionGrid${type.charAt(0).toUpperCase() + type.slice(1)}`);
      const tableId = type === 'pieces' ? 'inventaireTablePieces' : 'inventaireTableGemmes';
      
      // Calculer la valeur totale de ce type
      let totalValue = 0;
      document.querySelectorAll(`#${tableId} .total`).forEach(cell => {
        totalValue += parseFloat(cell.textContent) || 0;
      });
      
      if (totalValue === 0) {
        grid.innerHTML = '<p class="no-results">Aucun tr√©sor √† distribuer</p>';
        return;
      }
      
      // Distribution √©gale entre les membres
      const memberCount = guildMembers.length;
      const sharePerMember = totalValue / memberCount;
      
      grid.innerHTML = '';
      guildMembers.forEach(member => {
        const card = document.createElement('div');
        card.className = 'distribution-card';
        card.innerHTML = `
          <h4>${member.name}</h4>
          <div class="share-amount">${sharePerMember.toFixed(2)} PM</div>
          <div class="share-percentage">${(100 / memberCount).toFixed(1)}%</div>
        `;
        grid.appendChild(card);
      });
    }

    // ===== DISTRIBUTION G√âN√âRALE =====
    function updateAllDistributions() {
      updateDistribution();
      
      // Mettre √† jour les distributions dans les onglets monnaies/gemmes si elles sont visibles
      if (document.getElementById('distributionPieces').style.display !== 'none') {
        calculateDistributionForType('pieces');
      }
      if (document.getElementById('distributionGemmes').style.display !== 'none') {
        calculateDistributionForType('gemmes');
      }
    }

    function updateMembersPreview() {
      const preview = document.getElementById('membersPreview');
      preview.innerHTML = guildMembers.map(member => 
        `<span class="member-tag">${member.name} (${member.class})</span>`
      ).join('');
    }

    // ===== GESTION DES FILTRES POUR LA LISTE =====
    function filtrerParCategorie(categorie) {
      const sections = document.querySelectorAll('.category-section');
      sections.forEach(section => {
        if (categorie === '') {
          section.style.display = 'block';
        } else {
          const isRelevant = (categorie === 'pieces' && section.querySelector('#listMonetae')) ||
                           (categorie === 'gemmes' && section.querySelector('#listGemmae'));
          section.style.display = isRelevant ? 'block' : 'none';
        }
      });
    }

    function rechercherObjets(query) {
      if (!query.trim()) {
        document.querySelectorAll('#listMonetae tr, #listGemmae tr').forEach(row => {
          row.style.display = '';
        });
        return;
      }

      const queryLower = query.toLowerCase();
      
      document.querySelectorAll('#listMonetae tr, #listGemmae tr').forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        row.style.display = name.includes(queryLower) ? '' : 'none';
      });
    }

    // ===== FONCTIONS DE TRANSFERT =====
    function transferFromPersonal(type) {
      showNotification(`üì§ Fonction de transfert depuis l'inventaire personnel vers la guilde (${type})`);
      // √Ä impl√©menter : transfert depuis l'inventaire de Dorusis vers la guilde
    }

    // ===== DISTRIBUTION DU TR√âSOR =====
    function updateDistribution() {
      const memberCount = parseInt(document.getElementById('memberCount').value) || 4;
      const totalValue = parseFloat(document.getElementById('totalPieces').textContent) || 0;
      
      // Mettre √† jour les informations g√©n√©rales
      document.getElementById('totalToDistribute').textContent = totalValue.toFixed(2);
      document.getElementById('perMemberTotal').textContent = (totalValue / memberCount).toFixed(2);
      
      const grid = document.getElementById('distributionGridTotal');
      grid.innerHTML = '';
      
      if (totalValue === 0) {
        grid.innerHTML = '<p class="no-results">Aucun tr√©sor √† distribuer</p>';
        return;
      }
      
      // Distribution √©gale entre les membres
      const equalShare = totalValue / memberCount;
      
      guildMembers.slice(0, memberCount).forEach((member, index) => {
        const card = document.createElement('div');
        card.className = 'distribution-card';
        card.innerHTML = `
          <h4>${member.name}</h4>
          <div class="share-amount">${equalShare.toFixed(2)} PM</div>
          <div class="share-percentage">${(100 / memberCount).toFixed(1)}%</div>
        `;
        grid.appendChild(card);
      });
      
      // Si on a moins de membres configur√©s que le nombre demand√©, ajouter des membres g√©n√©riques
      for (let i = guildMembers.length; i < memberCount; i++) {
        const card = document.createElement('div');
        card.className = 'distribution-card';
        card.innerHTML = `
          <h4>Membre ${i + 1}</h4>
          <div class="share-amount">${equalShare.toFixed(2)} PM</div>
          <div class="share-percentage">${(100 / memberCount).toFixed(1)}%</div>
        `;
        grid.appendChild(card);
      }
    }

    // ===== GESTION DES CONTRIBUTIONS =====
    function openContributionModal() {
      document.getElementById('contributionModal').classList.add('active');
      populateMembersList();
    }

    function closeContributionModal() {
      document.getElementById('contributionModal').classList.remove('active');
    }

    function populateMembersList() {
      const membersList = document.getElementById('membersList');
      membersList.innerHTML = '';
      
      guildMembers.forEach((member, index) => {
        const memberDiv = document.createElement('div');
        memberDiv.className = 'member-contribution';
        memberDiv.innerHTML = `
          <div class="member-info">
            <input type="text" value="${member.name}" onchange="updateMemberName(${index}, this.value)" placeholder="Nom du membre">
            <select onchange="updateMemberClass(${index}, this.value)">
              <option value="Guerrier" ${member.class === 'Guerrier' ? 'selected' : ''}>Guerrier</option>
              <option value="Mage" ${member.class === 'Mage' ? 'selected' : ''}>Mage</option>
              <option value="Voleur" ${member.class === 'Voleur' ? 'selected' : ''}>Voleur</option>
              <option value="Pr√™tre" ${member.class === 'Pr√™tre' ? 'selected' : ''}>Pr√™tre</option>
            </select>
            <button onclick="removeMember(${index})" class="btn-action btn-delete">üóëÔ∏è</button>
          </div>
        `;
        membersList.appendChild(memberDiv);
      });
    }

    function addNewMember() {
      guildMembers.push({
        name: 'Nouveau Membre',
        contribution: 25,
        class: 'Guerrier'
      });
      populateMembersList();
      document.getElementById('memberCount').value = guildMembers.length;
      updateMembersPreview();
      updateAllDistributions();
    }

    function removeMember(index) {
      guildMembers.splice(index, 1);
      populateMembersList();
      document.getElementById('memberCount').value = guildMembers.length;
      updateMembersPreview();
      updateAllDistributions();
    }

    function updateMemberName(index, name) {
      guildMembers[index].name = name;
      updateMembersPreview();
      updateAllDistributions();
    }

    function updateMemberClass(index, classType) {
      guildMembers[index].class = classType;
      updateMembersPreview();
      updateAllDistributions();
    }

    function saveContributions() {
      closeContributionModal();
      updateAllDistributions();
      updateMembersPreview();
      showNotification('üíæ Membres sauvegard√©s');
    }

    // ===== POPULATION DE LA LISTE DES OBJETS =====
    function populateObjectsList() {
      // Peupler la liste des monnaies
      const listMonetae = document.getElementById('listMonetae');
      if (listMonetae) {
        listMonetae.innerHTML = '';
        Object.entries(window.monnaies.pieces)
          .sort(([,a], [,b]) => b - a)
          .forEach(([nom, valeur]) => {
            const row = listMonetae.insertRow();
            row.innerHTML = `
              <td><strong>${nom}</strong></td>
              <td>${valeur.toFixed(4)}</td>
            `;
          });
      }

      const listGemmae = document.getElementById('listGemmae');
      if (listGemmae) {
        listGemmae.innerHTML = '';
        Object.entries(window.monnaies.gemmes)
          .sort(([,a], [,b]) => b - a)
          .forEach(([nom, valeur]) => {
            const row = listGemmae.insertRow();
            row.innerHTML = `
              <td><strong>${nom}</strong></td>
              <td>${valeur.toFixed(2)}</td>
            `;
          });
      }
    }

    // ===== STATISTIQUES =====
    function updateStatistics() {
      if (!window.monnaies) return;
      
      // Statistiques des monnaies
      const monetaeKeys = Object.keys(window.monnaies.pieces);
      const monetaeValues = Object.values(window.monnaies.pieces);
      const avgMonetae = monetaeValues.reduce((a, b) => a + b, 0) / monetaeValues.length;
      const maxMonetae = Math.max(...monetaeValues);
      
      document.getElementById('countMonetae').textContent = monetaeKeys.length;
      document.getElementById('avgMonetae').textContent = avgMonetae.toFixed(2);
      document.getElementById('maxMonetae').textContent = maxMonetae.toFixed(2);
      
      // Statistiques des gemmes
      const gemmaeKeys = Object.keys(window.monnaies.gemmes);
      const gemmaeValues = Object.values(window.monnaies.gemmes);
      const avgGemmae = gemmaeValues.reduce((a, b) => a + b, 0) / gemmaeValues.length;
      const maxGemmae = Math.max(...gemmaeValues);
      
      document.getElementById('countGemmae').textContent = gemmaeKeys.length;
      document.getElementById('avgGemmae').textContent = avgGemmae.toFixed(2);
      document.getElementById('maxGemmae').textContent = maxGemmae.toFixed(2);
      
      // Calculs pour l'inventaire actuel
      const totalItems = document.querySelectorAll('#inventaireTablePieces tbody tr, #inventaireTableGemmes tbody tr').length;
      const totalValue = parseFloat(document.getElementById('totalPieces').textContent) || 0;
      
      document.getElementById('countTotal').textContent = totalItems;
      document.getElementById('valueTotal').textContent = totalValue.toFixed(2);
      
      // Status du tr√©sor de guilde
      let status = 'Vide';
      if (totalValue > 5000) status = 'Tr√®s riche';
      else if (totalValue > 2000) status = 'Riche';
      else if (totalValue > 500) status = 'Modeste';
      else if (totalValue > 100) status = 'Pauvre';
      else if (totalValue > 0) status = 'Tr√®s pauvre';
      
      document.getElementById('statusTotal').textContent = status;
      
      // Par membre
      const memberCount = guildMembers.length;
      const perMember = memberCount > 0 ? totalValue / memberCount : 0;
      document.getElementById('perMember').textContent = perMember.toFixed(2);
      
      // Distribution des valeurs
      let monetaeTotal = 0, gemmaeTotal = 0;
      
      document.querySelectorAll('#inventaireTablePieces .total').forEach(cell => {
        monetaeTotal += parseFloat(cell.textContent) || 0;
      });
      
      document.querySelectorAll('#inventaireTableGemmes .total').forEach(cell => {
        gemmaeTotal += parseFloat(cell.textContent) || 0;
      });
      
      const percentMonetae = totalValue > 0 ? (monetaeTotal / totalValue * 100).toFixed(1) : 0;
      const percentGemmae = totalValue > 0 ? (gemmaeTotal / totalValue * 100).toFixed(1) : 0;
      
      document.getElementById('percentMonetae').textContent = percentMonetae + '%';
      document.getElementById('percentGemmae').textContent = percentGemmae + '%';
      
      // Statistiques de guilde
      document.getElementById('activeMembers').textContent = memberCount;
      
      // Simuler des donn√©es de gestion
      const now = new Date();
      document.getElementById('lastContribution').textContent = now.toLocaleDateString('fr-FR');
      
      // Calculer la croissance (simul√©e)
      const growth = Math.random() * 10 - 2; // Entre -2% et +8%
      document.getElementById('growth').textContent = (growth >= 0 ? '+' : '') + growth.toFixed(1) + '%';
      
      // Stabilit√© bas√©e sur la valeur totale et le nombre de membres
      let stability = 'Stable';
      if (totalValue > 1000 && memberCount >= 3) stability = 'Prosp√®re';
      else if (totalValue < 100 || memberCount < 2) stability = 'Instable';
      else if (totalValue > 500) stability = 'En croissance';
      
      document.getElementById('stability').textContent = stability;
    }

    // ===== FONCTIONS UTILITAIRES =====
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 10000;
        background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);
        color: white; padding: 15px 25px; border-radius: 8px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        font-family: "Quattrocento Sans", Arial, sans-serif;
        font-weight: bold; font-size: 14px;
        border: 2px solid #228B22;
        animation: slideIn 0.3s ease;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // ===== INITIALISATION =====
    document.addEventListener('DOMContentLoaded', function() {
      console.log('‚öîÔ∏è Inventaire Guilde - Initialis√©');
      
      // Peupler la liste des objets
      populateObjectsList();
      
      // Mettre √† jour les statistiques
      updateStatistics();
      
      // Observer les changements dans les tableaux pour mettre √† jour les stats
      const observer = new MutationObserver(updateStatistics);
      
      const tables = document.querySelectorAll('#inventaireTablePieces tbody, #inventaireTableGemmes tbody');
      tables.forEach(table => {
        observer.observe(table, { childList: true, subtree: true });
      });
      
      // Observer les changements du total
      const totalObserver = new MutationObserver(updateStatistics);
      const totalElement = document.getElementById('totalPieces');
      if (totalElement) {
        totalObserver.observe(totalElement, { childList: true, characterData: true, subtree: true });
      }
      
      // Initialiser le nombre de membres et la preview
      document.getElementById('memberCount').value = guildMembers.length;
      updateMembersPreview();
    });

    // ===== EXPOSITION DES FONCTIONS =====
    window.switchInventoryTab = switchInventoryTab;
    window.updateStatistics = updateStatistics;
    window.filtrerParCategorie = filtrerParCategorie;
    window.rechercherObjets = rechercherObjets;
    window.transferFromPersonal = transferFromPersonal;
    window.distributeToMembers = distributeToMembers;
    window.updateDistribution = updateDistribution;
    window.updateAllDistributions = updateAllDistributions;
    window.openContributionModal = openContributionModal;
    window.closeContributionModal = closeContributionModal;
    window.addNewMember = addNewMember;
    window.removeMember = removeMember;
    window.updateMemberName = updateMemberName;
    window.updateMemberClass = updateMemberClass;
    window.saveContributions = saveContributions;
  </script>

  <!-- Styles suppl√©mentaires pour la guilde -->
  <style>
    .section-subtitle {
      text-align: center;
      font-style: italic;
      color: var(--primary-dark);
      margin-bottom: 20px;
    }

    .distribution-section {
      margin-top: 30px;
      padding: 20px;
      background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--content-bg) 100%);
      border-radius: var(--border-radius);
      border: 2px solid var(--accent-gold);
    }

    .distribution-section h3 {
      margin: 0 0 20px 0;
      color: var(--primary-bg);
      text-align: center;
      font-family: var(--font-title);
    }

    .distribution-config {
      background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--content-bg) 100%);
      padding: 25px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin-bottom: 25px;
    }

    .config-form {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
      margin-top: 15px;
      align-items: start;
    }

    .members-preview {
      background: var(--content-bg);
      padding: 15px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
    }

    .members-preview h4 {
      margin: 0 0 10px 0;
      color: var(--primary-dark);
      font-family: var(--font-title);
    }

    .member-tag {
      display: inline-block;
      background: var(--accent-gold);
      color: var(--primary-dark);
      padding: 4px 8px;
      margin: 2px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .total-summary {
      background: var(--content-bg);
      padding: 15px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin-bottom: 20px;
      text-align: center;
    }

    .total-summary p {
      margin: 8px 0;
      font-size: 1.1rem;
    }

    .distribution-results {
      margin-top: 25px;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .distribution-card {
      background: var(--content-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      text-align: center;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .distribution-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(47, 27, 20, 0.15);
      border-color: var(--accent-gold);
    }

    .distribution-card h4 {
      margin: 0 0 10px 0;
      color: var(--primary-bg);
      font-family: var(--font-title);
    }

    .share-amount {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-gold);
      margin: 10px 0;
    }

    .share-percentage {
      color: var(--primary-dark);
      font-style: italic;
    }

    .member-contribution {
      background: var(--content-bg);
      padding: 15px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin-bottom: 10px;
    }

    .member-info {
      display: grid;
      grid-template-columns: 2fr 1fr auto;
      gap: 10px;
      align-items: center;
    }

    .member-info input,
    .member-info select {
      margin: 0;
      padding: 8px;
      font-size: 0.9rem;
    }

    /* Responsive pour les modaux */
    @media (max-width: 768px) {
      .config-form {
        grid-template-columns: 1fr;
      }
      
      .results-grid {
        grid-template-columns: 1fr;
      }
      
      .member-info {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .popin-content {
        width: 95%;
        max-height: 95vh;
      }
    }
  </style>
</body>
</html>
  </div>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="script.js"></script>
  <script src="nav.js"></script>
  <script>
    // Variables globales pour la page Guilde
    let currentInventoryTab = 'pieces';
    let guildMembers = [
      { name: 'Dorusis', contribution: 25, class: 'Guerrier' },
      { name: 'Mage Aurelius', contribution: 30, class: 'Mage' },
      { name: 'Voleur Shadow', contribution: 20, class: 'Voleur' },
      { name: 'Pr√™tre Benedictus', contribution: 25, class: 'Pr√™tre' }
    ];

    // ===== GESTION DES ONGLETS D'INVENTAIRE =====
    function switchInventoryTab(tabName) {
      // D√©sactiver tous les onglets
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      // Activer l'onglet s√©lectionn√©
      const tabButton = document.querySelector(`[onclick="switchInventoryTab('${tabName}')"]`);
      const tabContent = document.getElementById(`tab-${tabName}`);
      
      if (tabButton && tabContent) {
        tabButton.classList.add('active');
        tabContent.classList.add('active');
        currentInventoryTab = tabName;
        
        if (tabName === 'distribution') {
          updateAllDistributions();
          updateMembersPreview();
        }
      }
    }

    // ===== DISTRIBUTION DANS LES ONGLETS MONNAIES/GEMMES =====
    function distributeToMembers(type) {
      const distributionSection = document.getElementById(`distribution${type.charAt(0).toUpperCase() + type.slice(1)}`);
      const grid = document.getElementById(`distributionGrid${type.charAt(0).toUpperCase() + type.slice(1)}`);
      
      if (distributionSection.style.display === 'none') {
        // Afficher la distribution
        distributionSection.style.display = 'block';
        calculateDistributionForType(type);
        showNotification(`üìä Distribution des ${type} calcul√©e`);
      } else {
        // Masquer la distribution
        distributionSection.style.display = 'none';
      }
    }

    function calculateDistributionForType(type) {
      const grid = document.getElementById(`distributionGrid${type.charAt(0).toUpperCase() + type.slice(1)}`);
      const tableId = type === 'pieces' ? 'inventaireTablePieces' : 'inventaireTableGemmes';
      
      // Calculer la valeur totale de ce type
      let totalValue = 0;
      document.querySelectorAll(`#${tableId} .total`).forEach(cell => {
        totalValue += parseFloat(cell.textContent) || 0;
      });
      
      if (totalValue === 0) {
        grid.innerHTML = '<p class="no-results">Aucun tr√©sor √† distribuer</p>';
        return;
      }
      
      // Distribution √©gale entre les membres
      const memberCount = guildMembers.length;
      const sharePerMember = totalValue / memberCount;
      
      grid.innerHTML = '';
      guildMembers.forEach(member => {
        const card = document.createElement('div');
        card.className = 'distribution-card';
        card.innerHTML = `
          <h4>${member.name}</h4>
          <div class="share-amount">${sharePerMember.toFixed(2)} PM</div>
          <div class="share-percentage">25.0%</div>
        `;
        grid.appendChild(card);
      });
    }

    // ===== DISTRIBUTION G√âN√âRALE =====
    function updateAllDistributions() {
      updateDistribution();
      
      // Mettre √† jour les distributions dans les onglets monnaies/gemmes si elles sont visibles
      if (document.getElementById('distributionPieces').style.display !== 'none') {
        calculateDistributionForType('pieces');
      }
      if (document.getElementById('distributionGemmes').style.display !== 'none') {
        calculateDistributionForType('gemmes');
      }
    }

    function updateMembersPreview() {
      const preview = document.getElementById('membersPreview');
      preview.innerHTML = guildMembers.map(member => 
        `<span class="member-tag">${member.name} (${member.class})</span>`
      ).join('');
    }

    // ===== GESTION DES FILTRES POUR LA LISTE =====
    function filtrerParCategorie(categorie) {
      const sections = document.querySelectorAll('.category-section');
      sections.forEach(section => {
        if (categorie === '') {
          section.style.display = 'block';
        } else {
          const isRelevant = (categorie === 'pieces' && section.querySelector('#listMonetae')) ||
                           (categorie === 'gemmes' && section.querySelector('#listGemmae'));
          section.style.display = isRelevant ? 'block' : 'none';
        }
      });
    }

    function rechercherObjets(query) {
      if (!query.trim()) {
        document.querySelectorAll('#listMonetae tr, #listGemmae tr').forEach(row => {
          row.style.display = '';
        });
        return;
      }

      const queryLower = query.toLowerCase();
      
      document.querySelectorAll('#listMonetae tr, #listGemmae tr').forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        row.style.display = name.includes(queryLower) ? '' : 'none';
      });
    }

    // ===== FONCTIONS DE TRANSFERT =====
    function transferFromPersonal(type) {
      showNotification(`üì§ Fonction de transfert depuis l'inventaire personnel vers la guilde (${type})`);
      // √Ä impl√©menter : transfert depuis l'inventaire de Dorusis vers la guilde
    }

    // ===== DISTRIBUTION DU TR√âSOR =====
    function updateDistribution() {
      const memberCount = parseInt(document.getElementById('memberCount').value) || 4;
      const totalValue = parseFloat(document.getElementById('totalPieces').textContent) || 0;
      
      // Mettre √† jour les informations g√©n√©rales
      document.getElementById('totalToDistribute').textContent = totalValue.toFixed(2);
      document.getElementById('perMemberTotal').textContent = (totalValue / memberCount).toFixed(2);
      
      const grid = document.getElementById('distributionGridTotal');
      grid.innerHTML = '';
      
      if (totalValue === 0) {
        grid.innerHTML = '<p class="no-results">Aucun tr√©sor √† distribuer</p>';
        return;
      }
      
      // Distribution √©gale entre les membres
      const equalShare = totalValue / memberCount;
      
      guildMembers.slice(0, memberCount).forEach((member, index) => {
        const card = document.createElement('div');
        card.className = 'distribution-card';
        card.innerHTML = `
          <h4>${member.name}</h4>
          <div class="share-amount">${equalShare.toFixed(2)} PM</div>
          <div class="share-percentage">${(100 / memberCount).toFixed(1)}%</div>
        `;
        grid.appendChild(card);
      });
      
      // Si on a moins de membres configur√©s que le nombre demand√©, ajouter des membres g√©n√©riques
      for (let i = guildMembers.length; i < memberCount; i++) {
        const card = document.createElement('div');
        card.className = 'distribution-card';
        card.innerHTML = `
          <h4>Membre ${i + 1}</h4>
          <div class="share-amount">${equalShare.toFixed(2)} PM</div>
          <div class="share-percentage">${(100 / memberCount).toFixed(1)}%</div>
        `;
        grid.appendChild(card);
      }
    }

    // ===== GESTION DES CONTRIBUTIONS =====
    function openContributionModal() {
      document.getElementById('contributionModal').classList.add('active');
      populateMembersList();
    }

    function closeContributionModal() {
      document.getElementById('contributionModal').classList.remove('active');
    }

    function populateMembersList() {
      const membersList = document.getElementById('membersList');
      membersList.innerHTML = '';
      
      guildMembers.forEach((member, index) => {
        const memberDiv = document.createElement('div');
        memberDiv.className = 'member-contribution';
        memberDiv.innerHTML = `
          <div class="member-info">
            <input type="text" value="${member.name}" onchange="updateMemberName(${index}, this.value)" placeholder="Nom du membre">
            <select onchange="updateMemberClass(${index}, this.value)">
              <option value="Guerrier" ${member.class === 'Guerrier' ? 'selected' : ''}>Guerrier</option>
              <option value="Mage" ${member.class === 'Mage' ? 'selected' : ''}>Mage</option>
              <option value="Voleur" ${member.class === 'Voleur' ? 'selected' : ''}>Voleur</option>
              <option value="Pr√™tre" ${member.class === 'Pr√™tre' ? 'selected' : ''}>Pr√™tre</option>
            </select>
            <button onclick="removeMember(${index})" class="btn-action btn-delete">üóëÔ∏è</button>
          </div>
        `;
        membersList.appendChild(memberDiv);
      });
    }

    function addNewMember() {
      guildMembers.push({
        name: 'Nouveau Membre',
        contribution: 25,
        class: 'Guerrier'
      });
      populateMembersList();
      document.getElementById('memberCount').value = guildMembers.length;
      updateMembersPreview();
      updateAllDistributions();
    }

    function removeMember(index) {
      guildMembers.splice(index, 1);
      populateMembersList();
      document.getElementById('memberCount').value = guildMembers.length;
      updateMembersPreview();
      updateAllDistributions();
    }

    function updateMemberName(index, name) {
      guildMembers[index].name = name;
      updateMembersPreview();
      updateAllDistributions();
    }

    function updateMemberClass(index, classType) {
      guildMembers[index].class = classType;
      updateMembersPreview();
      updateAllDistributions();
    }

    function saveContributions() {
      closeContributionModal();
      updateAllDistributions();
      updateMembersPreview();
      showNotification('üíæ Membres sauvegard√©s');
    }Div.innerHTML = `
          <div class="member-info">
            <input type="text" value="${member.name}" onchange="updateMemberName(${index}, this.value)" placeholder="Nom du membre">
            <select onchange="updateMemberClass(${index}, this.value)">
              <option value="Guerrier" ${member.class === 'Guerrier' ? 'selected' : ''}>Guerrier</option>
              <option value="Mage" ${member.class === 'Mage' ? 'selected' : ''}>Mage</option>
              <option value="Voleur" ${member.class === 'Voleur' ? 'selected' : ''}>Voleur</option>
              <option value="Pr√™tre" ${member.class === 'Pr√™tre' ? 'selected' : ''}>Pr√™tre</option>
            </select>
            <input type="number" value="${member.contribution}" onchange="updateMemberContribution(${index}, this.value)" min="0" max="100" placeholder="Contribution %">
            <button onclick="removeMember(${index})" class="btn-action btn-delete">üóëÔ∏è</button>
          </div>
        `;
        membersList.appendChild(memberDiv);
      });
    }

    function addNewMember() {
      guildMembers.push({
        name: 'Nouveau Membre',
        contribution: 0,
        class: 'Guerrier'
      });
      populateMembersList();
      document.getElementById('memberCount').value = guildMembers.length;
    }

    function removeMember(index) {
      guildMembers.splice(index, 1);
      populateMembersList();
      document.getElementById('memberCount').value = guildMembers.length;
    }

    function updateMemberName(index, name) {
      guildMembers[index].name = name;
    }

    function updateMemberClass(index, classType) {
      guildMembers[index].class = classType;
    }

    function updateMemberContribution(index, contribution) {
      guildMembers[index].contribution = parseInt(contribution) || 0;
    }

    function saveContributions() {
      // Normaliser les contributions pour qu'elles totalisent 100%
      const total = guildMembers.reduce((sum, member) => sum + member.contribution, 0);
      if (total > 0) {
        guildMembers.forEach(member => {
          member.contribution = (member.contribution / total) * 100;
        });
      }
      
      closeContributionModal();
      updateDistribution();
      showNotification('üíæ Contributions sauvegard√©es et normalis√©es');
    }

    // ===== POPULATION DE LA LISTE DES OBJETS =====
    function populateObjectsList() {
      // Peupler la liste des monnaies
      const listMonetae = document.getElementById('listMonetae');
      if (listMonetae) {
        listMonetae.innerHTML = '';
        Object.entries(window.monnaies.pieces)
          .sort(([,a], [,b]) => b - a)
          .forEach(([nom, valeur]) => {
            const row = listMonetae.insertRow();
            row.innerHTML = `
              <td><strong>${nom}</strong></td>
              <td>${valeur.toFixed(4)}</td>
            `;
          });
      }

      const listGemmae = document.getElementById('listGemmae');
      if (listGemmae) {
        listGemmae.innerHTML = '';
        Object.entries(window.monnaies.gemmes)
          .sort(([,a], [,b]) => b - a)
          .forEach(([nom, valeur]) => {
            const row = listGemmae.insertRow();
            row.innerHTML = `
              <td><strong>${nom}</strong></td>
              <td>${valeur.toFixed(2)}</td>
            `;
          });
      }
    }

    // ===== STATISTIQUES =====
    function updateStatistics() {
      if (!window.monnaies) return;
      
      // Statistiques des monnaies
      const monetaeKeys = Object.keys(window.monnaies.pieces);
      const monetaeValues = Object.values(window.monnaies.pieces);
      const avgMonetae = monetaeValues.reduce((a, b) => a + b, 0) / monetaeValues.length;
      const maxMonetae = Math.max(...monetaeValues);
      
      document.getElementById('countMonetae').textContent = monetaeKeys.length;
      document.getElementById('avgMonetae').textContent = avgMonetae.toFixed(2);
      document.getElementById('maxMonetae').textContent = maxMonetae.toFixed(2);
      
      // Statistiques des gemmes
      const gemmaeKeys = Object.keys(window.monnaies.gemmes);
      const gemmaeValues = Object.values(window.monnaies.gemmes);
      const avgGemmae = gemmaeValues.reduce((a, b) => a + b, 0) / gemmaeValues.length;
      const maxGemmae = Math.max(...gemmaeValues);
      
      document.getElementById('countGemmae').textContent = gemmaeKeys.length;
      document.getElementById('avgGemmae').textContent = avgGemmae.toFixed(2);
      document.getElementById('maxGemmae').textContent = maxGemmae.toFixed(2);
      
      // Calculs pour l'inventaire actuel
      const totalItems = document.querySelectorAll('#inventaireTablePieces tbody tr, #inventaireTableGemmes tbody tr').length;
      const totalValue = parseFloat(document.getElementById('totalPieces').textContent) || 0;
      
      document.getElementById('countTotal').textContent = totalItems;
      document.getElementById('valueTotal').textContent = totalValue.toFixed(2);
      
      // Status du tr√©sor de guilde
      let status = 'Vide';
      if (totalValue > 5000) status = 'Tr√®s riche';
      else if (totalValue > 2000) status = 'Riche';
      else if (totalValue > 500) status = 'Modeste';
      else if (totalValue > 100) status = 'Pauvre';
      else if (totalValue > 0) status = 'Tr√®s pauvre';
      
      document.getElementById('statusTotal').textContent = status;
      
      // Par membre
      const memberCount = guildMembers.length;
      const perMember = memberCount > 0 ? totalValue / memberCount : 0;
      document.getElementById('perMember').textContent = perMember.toFixed(2);
      
      // Distribution des valeurs
      let monetaeTotal = 0, gemmaeTotal = 0;
      
      document.querySelectorAll('#inventaireTablePieces .total').forEach(cell => {
        monetaeTotal += parseFloat(cell.textContent) || 0;
      });
      
      document.querySelectorAll('#inventaireTableGemmes .total').forEach(cell => {
        gemmaeTotal += parseFloat(cell.textContent) || 0;
      });
      
      const percentMonetae = totalValue > 0 ? (monetaeTotal / totalValue * 100).toFixed(1) : 0;
      const percentGemmae = totalValue > 0 ? (gemmaeTotal / totalValue * 100).toFixed(1) : 0;
      
      document.getElementById('percentMonetae').textContent = percentMonetae + '%';
      document.getElementById('percentGemmae').textContent = percentGemmae + '%';
      
      // Statistiques de guilde
      document.getElementById('activeMembers').textContent = memberCount;
      
      // Simuler des donn√©es de gestion
      const now = new Date();
      document.getElementById('lastContribution').textContent = now.toLocaleDateString('fr-FR');
      
      // Calculer la croissance (simul√©e)
      const growth = Math.random() * 10 - 2; // Entre -2% et +8%
      document.getElementById('growth').textContent = (growth >= 0 ? '+' : '') + growth.toFixed(1) + '%';
      
      // Stabilit√© bas√©e sur la valeur totale et le nombre de membres
      let stability = 'Stable';
      if (totalValue > 1000 && memberCount >= 3) stability = 'Prosp√®re';
      else if (totalValue < 100 || memberCount < 2) stability = 'Instable';
      else if (totalValue > 500) stability = 'En croissance';
      
      document.getElementById('stability').textContent = stability;
    }

    // ===== FONCTIONS UTILITAIRES =====
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 10000;
        background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);
        color: white; padding: 15px 25px; border-radius: 8px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        font-family: "Quattrocento Sans", Arial, sans-serif;
        font-weight: bold; font-size: 14px;
        border: 2px solid #228B22;
        animation: slideIn 0.3s ease;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // ===== INITIALISATION =====
    document.addEventListener('DOMContentLoaded', function() {
      console.log('‚öîÔ∏è Inventaire Guilde - Initialis√©');
      
      // Peupler la liste des objets
      populateObjectsList();
      
      // Mettre √† jour les statistiques
      updateStatistics();
      
      // Observer les changements dans les tableaux pour mettre √† jour les stats
      const observer = new MutationObserver(updateStatistics);
      
      const tables = document.querySelectorAll('#inventaireTablePieces tbody, #inventaireTableGemmes tbody');
      tables.forEach(table => {
        observer.observe(table, { childList: true, subtree: true });
      });
      
      // Observer les changements du total
      const totalObserver = new MutationObserver(updateStatistics);
      const totalElement = document.getElementById('totalPieces');
      if (totalElement) {
        totalObserver.observe(totalElement, { childList: true, characterData: true, subtree: true });
      }
      
      // Recherche en temps r√©el
      document.getElementById('searchInput').addEventListener('input', function() {
        if (this.value.length >= 2) {
          performSearch();
        } else if (this.value.length === 0) {
          clearSearch();
        }
      });
      
      // Recherche par Entr√©e
      document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
      
      // Initialiser le nombre de membres
      document.getElementById('memberCount').value = guildMembers.length;
    });

    // ===== EXPOSITION DES FONCTIONS =====
    window.switchInventoryTab = switchInventoryTab;
    window.performSearch = performSearch;
    window.clearSearch = clearSearch;
    window.updateStatistics = updateStatistics;
    window.filtrerParCategorie = filtrerParCategorie;
    window.rechercherObjets = rechercherObjets;
    window.transferFromPersonal = transferFromPersonal;
    window.updateDistribution = updateDistribution;
    window.calculateEqualDistribution = calculateEqualDistribution;
    window.openContributionModal = openContributionModal;
    window.closeContributionModal = closeContributionModal;
    window.addNewMember = addNewMember;
    window.removeMember = removeMember;
    window.updateMemberName = updateMemberName;
    window.updateMemberClass = updateMemberClass;
    window.updateMemberContribution = updateMemberContribution;
    window.saveContributions = saveContributions;
  </script>

  <!-- Styles suppl√©mentaires pour la guilde -->
  <style>
    .section-subtitle {
      text-align: center;
      font-style: italic;
      color: var(--primary-dark);
      margin-bottom: 20px;
    }

    .distribution-config {
      background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--content-bg) 100%);
      padding: 25px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin-bottom: 25px;
    }

    .config-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .distribution-results {
      margin-top: 25px;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .distribution-card {
      background: var(--content-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      text-align: center;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .distribution-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(47, 27, 20, 0.15);
      border-color: var(--accent-gold);
    }

    .distribution-card h4 {
      margin: 0 0 10px 0;
      color: var(--primary-bg);
      font-family: var(--font-title);
    }

    .share-amount {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-gold);
      margin: 10px 0;
    }

    .share-percentage {
      color: var(--primary-dark);
      font-style: italic;
    }

    .member-contribution {
      background: var(--content-bg);
      padding: 15px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin-bottom: 10px;
    }

    .member-info {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto;
      gap: 10px;
      align-items: center;
    }

    .member-info input,
    .member-info select {
      margin: 0;
      padding: 8px;
      font-size: 0.9rem;
    }

    .result-source {
      font-size: 0.8rem;
      color: var(--primary-dark);
      font-style: italic;
      margin-top: 5px;
    }

    /* Responsive pour les modaux */
    @media (max-width: 768px) {
      .config-form {
        grid-template-columns: 1fr;
      }
      
      .results-grid {
        grid-template-columns: 1fr;
      }
      
      .member-info {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .popin-content {
        width: 95%;
        max-height: 95vh;
      }
    }
  </style>
</body>
</html>
