<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventaire Guilde</title>
  <meta name="description" content="Inventaire commun de la guilde - Gestion du tr√©sor collectif">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="content fade-in">
    <!-- En-t√™te de la page -->
    <header class="page-header">
      <h1>‚öîÔ∏è INVENTAIRE GUILDE ‚öîÔ∏è</h1>
      <p class="page-subtitle">Tr√©sor commun de la confr√©rie</p>
    </header>

    <!-- Contr√¥les principaux -->
    <section class="section">
      <div class="controls-header">
        <div class="controls-left">
          <h2>üí∞ Gestion du Tr√©sor Commun</h2>
        </div>
        <div class="controls-right">
          <input type="file" accept=".json" id="fileInputInventory" style="display: none;">
          <button onclick="document.getElementById('fileInputInventory').click()" class="btn-action btn-load">
            üìÇ Importer
          </button>
          <button id="saveInventoryBtn" class="btn-action btn-save">
            üíæ Sauvegarder
          </button>
        </div>
      </div>
      
      <!-- Affichage du total -->
      <div class="total-display">
        <span class="total-label">Valeur Totale Guilde:</span>
        <span id="totalPieces" class="total-value">0</span>
        <span class="total-unit">PM</span>
      </div>
    </section>

    <!-- Onglets des inventaires -->
    <section class="section">
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-button active" onclick="switchInventoryTab('pieces')" title="Monnaies m√©talliques de la guilde">
            ü™ô Monnaies
          </button>
          <button class="tab-button" onclick="switchInventoryTab('gemmes')" title="Gemmes pr√©cieuses de la guilde">
            üíé Gemmes
          </button>
          <button class="tab-button" onclick="switchInventoryTab('search')" title="Rechercher dans le tr√©sor de guilde">
            üîç Recherche
          </button>
          <button class="tab-button" onclick="switchInventoryTab('distribution')" title="Distribution entre les membres">
            üìä Distribution
          </button>
        </div>

        <!-- Inventaire des Pi√®ces -->
        <div id="tab-pieces" class="tab-content active">
          <div class="tab-header">
            <h2>ü™ô Monnaies M√©talliques de la Guilde</h2>
            <div class="tab-actions">
              <button onclick="addInventaireRow('pieces')" class="btn-action btn-add">
                ‚ûï Ajouter une monnaie
              </button>
              <button onclick="transferFromPersonal('pieces')" class="btn-action btn-transfer">
                üì§ Transfer depuis personnel
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="inventaireTablePieces" class="inventory-table">
              <thead>
                <tr>
                  <th width="25%">Nom</th>
                  <th width="15%">Quantit√©</th>
                  <th width="15%">Valeur Unitaire</th>
                  <th width="15%">Valeur Totale</th>
                  <th width="15%">Contribution</th>
                  <th width="15%">Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Lignes g√©n√©r√©es dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Inventaire des Gemmes -->
        <div id="tab-gemmes" class="tab-content">
          <div class="tab-header">
            <h2>üíé Gemmes Pr√©cieuses de la Guilde</h2>
            <div class="tab-actions">
              <button onclick="addInventaireRow('gemmes')" class="btn-action btn-add">
                ‚ûï Ajouter une gemme
              </button>
              <button onclick="transferFromPersonal('gemmes')" class="btn-action btn-transfer">
                üì§ Transfer depuis personnel
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="inventaireTableGemmes" class="inventory-table">
              <thead>
                <tr>
                  <th width="25%">Nom</th>
                  <th width="15%">Quantit√©</th>
                  <th width="15%">Valeur Unitaire</th>
                  <th width="15%">Valeur Totale</th>
                  <th width="15%">Contribution</th>
                  <th width="15%">Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Lignes g√©n√©r√©es dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Onglet Recherche -->
        <div id="tab-search" class="tab-content">
          <div class="tab-header">
            <h2>üîç Rechercher dans le Tr√©sor de Guilde</h2>
          </div>
          
          <div class="search-container">
            <div class="search-form">
              <div>
                <label for="searchInput">Rechercher un nom:</label>
                <input type="text" id="searchInput" class="search-input" 
                       placeholder="Exemple: Or, Rubis..." 
                       oninput="performSearch()">
              </div>
              <button onclick="performSearch()" class="btn-action search-btn">
                üîç Rechercher
              </button>
              <button onclick="clearSearch()" class="btn-action clear-btn">
                üóëÔ∏è Effacer
              </button>
            </div>
          </div>
          
          <div class="search-results" id="searchResults">
            <div class="no-results">
              <p>üîç Tapez le nom de l'objet que vous cherchez dans le tr√©sor de guilde...</p>
            </div>
          </div>
        </div>

        <!-- Onglet Distribution -->
        <div id="tab-distribution" class="tab-content">
          <div class="tab-header">
            <h2>üìä Distribution du Tr√©sor</h2>
            <div class="tab-actions">
              <button onclick="calculateEqualDistribution()" class="btn-action btn-load">
                ‚öñÔ∏è Distribution √âgale
              </button>
              <button onclick="openContributionModal()" class="btn-action btn-add">
                üìù Gestion des Contributions
              </button>
            </div>
          </div>
          
          <!-- Configuration de la distribution -->
          <div class="distribution-config">
            <h3>‚öôÔ∏è Configuration des Distributions</h3>
            <div class="config-form">
              <div class="input-group">
                <label for="memberCount">Nombre de Membres:</label>
                <input type="number" id="memberCount" value="4" min="1" max="20" onchange="updateDistribution()">
              </div>
              <div class="input-group">
                <label for="distributionType">Type de Distribution:</label>
                <select id="distributionType" onchange="updateDistribution()">
                  <option value="equal">√âgale (Parts √©gales)</option>
                  <option value="weighted">Pond√©r√©e (Par contribution)</option>
                  <option value="class">Par Classes (Par classe de personnage)</option>
                </select>
              </div>
            </div>
          </div>

          <!-- R√©sultats de distribution -->
          <div class="distribution-results">
            <h3>üìà R√©sultats de Distribution</h3>
            <div class="results-grid" id="distributionGrid">
              <!-- G√©n√©r√© dynamiquement -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Informations sur le tr√©sor de guilde -->
    <section class="section">
      <h2>üìä Statistiques du Tr√©sor de Guilde</h2>
      <div class="info-grid">
        <div class="info-card">
          <h3>ü™ô √âtat des Monnaies</h3>
          <div id="statsMonetae">
            <p>Types disponibles: <span id="countMonetae">-</span></p>
            <p>Valeur moyenne: <span id="avgMonetae">-</span> PM</p>
            <p>Valeur maximale: <span id="maxMonetae">-</span> PM</p>
            <p>Pourcentage du total: <span id="percentMonetae">0%</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>üíé √âtat des Gemmes</h3>
          <div id="statsGemmae">
            <p>Types disponibles: <span id="countGemmae">-</span></p>
            <p>Valeur moyenne: <span id="avgGemmae">-</span> PM</p>
            <p>Valeur maximale: <span id="maxGemmae">-</span> PM</p>
            <p>Pourcentage du total: <span id="percentGemmae">0%</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>‚öñÔ∏è Total du Tr√©sor</h3>
          <div id="statsTotal">
            <p>Objets totaux: <span id="countTotal">0</span></p>
            <p>Valeur totale: <span id="valueTotal">0</span> PM</p>
            <p>√âtat de la guilde: <span id="statusTotal">Vide</span></p>
            <p>Par membre: <span id="perMember">0</span> PM</p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>üìà Gestion de Guilde</h3>
          <div id="statsGuild">
            <p>Membres actifs: <span id="activeMembers">4</span></p>
            <p>Derni√®re contribution: <span id="lastContribution">Jamais</span></p>
            <p>Croissance: <span id="growth">+0%</span> (mois)</p>
            <p>Stabilit√©: <span id="stability">Stable</span></p>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal pour les contributions -->
    <div id="contributionModal" class="popin-overlay" onclick="closeContributionModal()">
      <div class="popin-content" onclick="event.stopPropagation()">
        <div class="popin-header">
          <h2>üìù Gestion des Contributions</h2>
          <button onclick="closeContributionModal()" class="popin-close">‚úï</button>
        </div>
        
        <div class="popin-form">
          <h3>Membres et leurs Contributions</h3>
          <div id="membersList">
            <!-- G√©n√©r√© dynamiquement -->
          </div>
          
          <div class="form-field">
            <button onclick="addNewMember()" class="btn-action btn-add">
              ‚ûï Ajouter un Membre
            </button>
            <button onclick="saveContributions()" class="btn-action btn-save">
              üíæ Sauvegarder les Contributions
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="script.js"></script>
  <script src="nav.js"></script>
  <script>
    // Variables globales pour la page Guilde
    let currentInventoryTab = 'pieces';
    let guildMembers = [
      { name: 'Dorusis', contribution: 25, class: 'Guerrier' },
      { name: 'Mage Aurelius', contribution: 30, class: 'Mage' },
      { name: 'Voleur Shadow', contribution: 20, class: 'Voleur' },
      { name: 'Pr√™tre Benedictus', contribution: 25, class: 'Pr√™tre' }
    ];

    // ===== GESTION DES ONGLETS D'INVENTAIRE =====
    function switchInventoryTab(tabName) {
      // D√©sactiver tous les onglets
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      // Activer l'onglet s√©lectionn√©
      const tabButton = document.querySelector(`[onclick="switchInventoryTab('${tabName}')"]`);
      const tabContent = document.getElementById(`tab-${tabName}`);
      
      if (tabButton && tabContent) {
        tabButton.classList.add('active');
        tabContent.classList.add('active');
        currentInventoryTab = tabName;
        
        if (tabName === 'search') {
          document.getElementById('searchInput').focus();
        } else if (tabName === 'distribution') {
          updateDistribution();
        }
      }
    }

    // ===== FONCTIONS DE RECHERCHE =====
    function performSearch() {
      const query = document.getElementById('searchInput').value.toLowerCase().trim();
      const resultsContainer = document.getElementById('searchResults');
      
      if (!query) {
        resultsContainer.innerHTML = '<div class="no-results"><p>üîç Scribe nomen rei quam quaeris in thesauro guildae...</p></div>';
        return;
      }
      
      const results = [];
      
      // Rechercher dans les pi√®ces de l'inventaire guilde
      document.querySelectorAll('#inventaireTablePieces tbody tr').forEach(row => {
        const nameCell = row.cells[0].querySelector('select');
        if (nameCell && nameCell.value.toLowerCase().includes(query)) {
          const quantityCell = row.cells[1].querySelector('input');
          results.push({
            nom: nameCell.value,
            type: 'pieces',
            quantite: parseFloat(quantityCell.value) || 0,
            source: 'Inventarium Guildae'
          });
        }
      });
      
      // Rechercher dans les gemmes de l'inventaire guilde
      document.querySelectorAll('#inventaireTableGemmes tbody tr').forEach(row => {
        const nameCell = row.cells[0].querySelector('select');
        if (nameCell && nameCell.value.toLowerCase().includes(query)) {
          const quantityCell = row.cells[1].querySelector('input');
          results.push({
            nom: nameCell.value,
            type: 'gemmes',
            quantite: parseFloat(quantityCell.value) || 0,
            source: 'Inventarium Guildae'
          });
        }
      });
      
      // Rechercher dans les objets disponibles
      Object.entries(window.monnaies.pieces).forEach(([nom, valeur]) => {
        if (nom.toLowerCase().includes(query)) {
          results.push({
            nom: nom,
            valeur: valeur,
            categorie: 'Monetae',
            type: 'pieces',
            source: 'Disponibilis'
          });
        }
      });
      
      Object.entries(window.monnaies.gemmes).forEach(([nom, valeur]) => {
        if (nom.toLowerCase().includes(query)) {
          results.push({
            nom: nom,
            valeur: valeur,
            categorie: 'Gemmae',
            type: 'gemmes',
            source: 'Disponibilis'
          });
        }
      });
      
      displaySearchResults(results, query);
    }
    
    function displaySearchResults(results, query) {
      const container = document.getElementById('searchResults');
      
      if (results.length === 0) {
        container.innerHTML = `
          <div class="no-results">
            <p>‚ùå Nullum resultatum pro "${query}" in thesauro guildae</p>
            <p><em>Tenta aliam quaestionem...</em></p>
          </div>
        `;
        return;
      }
      
      const html = results.map(item => `
        <div class="result-item">
          <div class="result-header">
            <span class="result-name">${item.nom}</span>
            <span class="result-category">${item.categorie || item.type}</span>
          </div>
          <div class="result-value">
            ${item.quantite ? `Quantitas in guilda: ${item.quantite}` : ''}
            ${item.valeur ? `Valor: ${item.valeur} PM` : ''}
          </div>
          <div class="result-source">Fons: ${item.source}</div>
        </div>
      `).join('');
      
      container.innerHTML = `
        <h3>üìã Resultata pro "${query}" (${results.length})</h3>
        ${html}
      `;
    }
    
    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResults').innerHTML = '<div class="no-results"><p>üîç Scribe nomen rei quam quaeris in thesauro guildae...</p></div>';
    }

    // ===== GESTION DES FILTRES POUR LA LISTE =====
    function filtrerParCategorie(categorie) {
      const sections = document.querySelectorAll('.category-section');
      sections.forEach(section => {
        if (categorie === '') {
          section.style.display = 'block';
        } else {
          const isRelevant = (categorie === 'pieces' && section.querySelector('#listMonetae')) ||
                           (categorie === 'gemmes' && section.querySelector('#listGemmae'));
          section.style.display = isRelevant ? 'block' : 'none';
        }
      });
    }

    function rechercherObjets(query) {
      if (!query.trim()) {
        document.querySelectorAll('#listMonetae tr, #listGemmae tr').forEach(row => {
          row.style.display = '';
        });
        return;
      }

      const queryLower = query.toLowerCase();
      
      document.querySelectorAll('#listMonetae tr, #listGemmae tr').forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        row.style.display = name.includes(queryLower) ? '' : 'none';
      });
    }

    // ===== FONCTIONS DE TRANSFERT =====
    function transferFromPersonal(type) {
      showNotification(`üì§ Fonction de transfert depuis l'inventaire personnel vers la guilde (${type})`);
      // √Ä impl√©menter : transfert depuis l'inventaire de Dorusis vers la guilde
    }

    // ===== DISTRIBUTION DU TR√âSOR =====
    function updateDistribution() {
      const memberCount = parseInt(document.getElementById('memberCount').value) || 4;
      const distributionType = document.getElementById('distributionType').value;
      const totalValue = parseFloat(document.getElementById('totalPieces').textContent) || 0;
      
      const grid = document.getElementById('distributionGrid');
      grid.innerHTML = '';
      
      if (totalValue === 0) {
        grid.innerHTML = '<p class="no-results">Nullus thesaurus pro distributione</p>';
        return;
      }
      
      let distributions = [];
      
      switch (distributionType) {
        case 'equal':
          const equalShare = totalValue / memberCount;
          for (let i = 1; i <= memberCount; i++) {
            distributions.push({
              member: `Sodalis ${i}`,
              share: equalShare,
              percentage: 100 / memberCount
            });
          }
          break;
          
        case 'weighted':
          const totalContribution = guildMembers.reduce((sum, member) => sum + member.contribution, 0);
          guildMembers.forEach(member => {
            distributions.push({
              member: member.name,
              share: (member.contribution / totalContribution) * totalValue,
              percentage: (member.contribution / totalContribution) * 100
            });
          });
          break;
          
        case 'class':
          // Distribution par classe avec bonus/malus
          const classMultipliers = {
            'Bellator': 1.1,
            'Magus': 1.0,
            'Fur': 0.9,
            'Clericus': 1.0
          };
          const totalMultiplied = guildMembers.reduce((sum, member) => sum + (classMultipliers[member.class] || 1), 0);
          guildMembers.forEach(member => {
            const multiplier = classMultipliers[member.class] || 1;
            distributions.push({
              member: `${member.name} (${member.class})`,
              share: (multiplier / totalMultiplied) * totalValue,
              percentage: (multiplier / totalMultiplied) * 100
            });
          });
          break;
      }
      
      distributions.forEach(dist => {
        const card = document.createElement('div');
        card.className = 'distribution-card';
        card.innerHTML = `
          <h4>${dist.member}</h4>
          <div class="share-amount">${dist.share.toFixed(2)} PM</div>
          <div class="share-percentage">${dist.percentage.toFixed(1)}%</div>
        `;
        grid.appendChild(card);
      });
    }

    function calculateEqualDistribution() {
      document.getElementById('distributionType').value = 'equal';
      updateDistribution();
      showNotification('‚öñÔ∏è Distributio aequalis calculata');
    }

    // ===== GESTION DES CONTRIBUTIONS =====
    function openContributionModal() {
      document.getElementById('contributionModal').classList.add('active');
      populateMembersList();
    }

    function closeContributionModal() {
      document.getElementById('contributionModal').classList.remove('active');
    }

    function populateMembersList() {
      const membersList = document.getElementById('membersList');
      membersList.innerHTML = '';
      
      guildMembers.forEach((member, index) => {
        const memberDiv = document.createElement('div');
        memberDiv.className = 'member-contribution';
        memberDiv.innerHTML = `
          <div class="member-info">
            <input type="text" value="${member.name}" onchange="updateMemberName(${index}, this.value)" placeholder="Nomen sodalis">
            <select onchange="updateMemberClass(${index}, this.value)">
              <option value="Bellator" ${member.class === 'Bellator' ? 'selected' : ''}>Bellator</option>
              <option value="Magus" ${member.class === 'Magus' ? 'selected' : ''}>Magus</option>
              <option value="Fur" ${member.class === 'Fur' ? 'selected' : ''}>Fur</option>
              <option value="Clericus" ${member.class === 'Clericus' ? 'selected' : ''}>Clericus</option>
            </select>
            <input type="number" value="${member.contribution}" onchange="updateMemberContribution(${index}, this.value)" min="0" max="100" placeholder="Contributio %">
            <button onclick="removeMember(${index})" class="btn-action btn-delete">üóëÔ∏è</button>
          </div>
        `;
        membersList.appendChild(memberDiv);
      });
    }

    function addNewMember() {
      guildMembers.push({
        name: 'Novus Sodalis',
        contribution: 0,
        class: 'Bellator'
      });
      populateMembersList();
      document.getElementById('memberCount').value = guildMembers.length;
    }

    function removeMember(index) {
      guildMembers.splice(index, 1);
      populateMembersList();
      document.getElementById('memberCount').value = guildMembers.length;
    }

    function updateMemberName(index, name) {
      guildMembers[index].name = name;
    }

    function updateMemberClass(index, classType) {
      guildMembers[index].class = classType;
    }

    function updateMemberContribution(index, contribution) {
      guildMembers[index].contribution = parseInt(contribution) || 0;
    }

    function saveContributions() {
      // Normaliser les contributions pour qu'elles totalisent 100%
      const total = guildMembers.reduce((sum, member) => sum + member.contribution, 0);
      if (total > 0) {
        guildMembers.forEach(member => {
          member.contribution = (member.contribution / total) * 100;
        });
      }
      
      closeContributionModal();
      updateDistribution();
      showNotification('üíæ Contributiones salvatae et normalizatae');
    }

    // ===== POPULATION DE LA LISTE DES OBJETS =====
    function populateObjectsList() {
      // Peupler la liste des monnaies
      const listMonetae = document.getElementById('listMonetae');
      if (listMonetae) {
        listMonetae.innerHTML = '';
        Object.entries(window.monnaies.pieces)
          .sort(([,a], [,b]) => b - a)
          .forEach(([nom, valeur]) => {
            const row = listMonetae.insertRow();
            row.innerHTML = `
              <td><strong>${nom}</strong></td>
              <td>${valeur.toFixed(4)}</td>
            `;
          });
      }

      const listGemmae = document.getElementById('listGemmae');
      if (listGemmae) {
        listGemmae.innerHTML = '';
        Object.entries(window.monnaies.gemmes)
          .sort(([,a], [,b]) => b - a)
          .forEach(([nom, valeur]) => {
            const row = listGemmae.insertRow();
            row.innerHTML = `
              <td><strong>${nom}</strong></td>
              <td>${valeur.toFixed(2)}</td>
            `;
          });
      }
    }

    // ===== STATISTIQUES =====
    function updateStatistics() {
      if (!window.monnaies) return;
      
      // Statistiques des monnaies
      const monetaeKeys = Object.keys(window.monnaies.pieces);
      const monetaeValues = Object.values(window.monnaies.pieces);
      const avgMonetae = monetaeValues.reduce((a, b) => a + b, 0) / monetaeValues.length;
      const maxMonetae = Math.max(...monetaeValues);
      
      document.getElementById('countMonetae').textContent = monetaeKeys.length;
      document.getElementById('avgMonetae').textContent = avgMonetae.toFixed(2);
      document.getElementById('maxMonetae').textContent = maxMonetae.toFixed(2);
      
      // Statistiques des gemmes
      const gemmaeKeys = Object.keys(window.monnaies.gemmes);
      const gemmaeValues = Object.values(window.monnaies.gemmes);
      const avgGemmae = gemmaeValues.reduce((a, b) => a + b, 0) / gemmaeValues.length;
      const maxGemmae = Math.max(...gemmaeValues);
      
      document.getElementById('countGemmae').textContent = gemmaeKeys.length;
      document.getElementById('avgGemmae').textContent = avgGemmae.toFixed(2);
      document.getElementById('maxGemmae').textContent = maxGemmae.toFixed(2);
      
      // Calculs pour l'inventaire actuel
      const totalItems = document.querySelectorAll('#inventaireTablePieces tbody tr, #inventaireTableGemmes tbody tr').length;
      const totalValue = parseFloat(document.getElementById('totalPieces').textContent) || 0;
      
      document.getElementById('countTotal').textContent = totalItems;
      document.getElementById('valueTotal').textContent = totalValue.toFixed(2);
      
      // Status du tr√©sor de guilde
      let status = 'Vacua';
      if (totalValue > 5000) status = 'Ditissima';
      else if (totalValue > 2000) status = 'Dives';
      else if (totalValue > 500) status = 'Mediocris';
      else if (totalValue > 100) status = 'Modesta';
      else if (totalValue > 0) status = 'Paupera';
      
      document.getElementById('statusTotal').textContent = status;
      
      // Par membre
      const memberCount = guildMembers.length;
      const perMember = memberCount > 0 ? totalValue / memberCount : 0;
      document.getElementById('perMember').textContent = perMember.toFixed(2);
      
      // Distribution des valeurs
      let monetaeTotal = 0, gemmaeTotal = 0;
      
      document.querySelectorAll('#inventaireTablePieces .total').forEach(cell => {
        monetaeTotal += parseFloat(cell.textContent) || 0;
      });
      
      document.querySelectorAll('#inventaireTableGemmes .total').forEach(cell => {
        gemmaeTotal += parseFloat(cell.textContent) || 0;
      });
      
      const percentMonetae = totalValue > 0 ? (monetaeTotal / totalValue * 100).toFixed(1) : 0;
      const percentGemmae = totalValue > 0 ? (gemmaeTotal / totalValue * 100).toFixed(1) : 0;
      
      document.getElementById('percentMonetae').textContent = percentMonetae + '%';
      document.getElementById('percentGemmae').textContent = percentGemmae + '%';
      
      // Statistiques de guilde
      document.getElementById('activeMembers').textContent = memberCount;
      
      // Simuler des donn√©es de gestion
      const now = new Date();
      document.getElementById('lastContribution').textContent = now.toLocaleDateString('la');
      
      // Calculer la croissance (simul√©e)
      const growth = Math.random() * 10 - 2; // Entre -2% et +8%
      document.getElementById('growth').textContent = (growth >= 0 ? '+' : '') + growth.toFixed(1) + '%';
      
      // Stabilit√© bas√©e sur la valeur totale et le nombre de membres
      let stability = 'Stabilis';
      if (totalValue > 1000 && memberCount >= 3) stability = 'Prosperus';
      else if (totalValue < 100 || memberCount < 2) stability = 'Instabilis';
      else if (totalValue > 500) stability = 'Crescens';
      
      document.getElementById('stability').textContent = stability;
    }

    // ===== FONCTIONS UTILITAIRES =====
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 10000;
        background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);
        color: white; padding: 15px 25px; border-radius: 8px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        font-family: "Quattrocento Sans", Arial, sans-serif;
        font-weight: bold; font-size: 14px;
        border: 2px solid #228B22;
        animation: slideIn 0.3s ease;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // ===== INITIALISATION =====
    document.addEventListener('DOMContentLoaded', function() {
      console.log('‚öîÔ∏è Inventarium Guildae - Initialis√©');
      
      // Peupler la liste des objets
      populateObjectsList();
      
      // Mettre √† jour les statistiques
      updateStatistics();
      
      // Observer les changements dans les tableaux pour mettre √† jour les stats
      const observer = new MutationObserver(updateStatistics);
      
      const tables = document.querySelectorAll('#inventaireTablePieces tbody, #inventaireTableGemmes tbody');
      tables.forEach(table => {
        observer.observe(table, { childList: true, subtree: true });
      });
      
      // Observer les changements du total
      const totalObserver = new MutationObserver(updateStatistics);
      const totalElement = document.getElementById('totalPieces');
      if (totalElement) {
        totalObserver.observe(totalElement, { childList: true, characterData: true, subtree: true });
      }
      
      // Recherche en temps r√©el
      document.getElementById('searchInput').addEventListener('input', function() {
        if (this.value.length >= 2) {
          performSearch();
        } else if (this.value.length === 0) {
          clearSearch();
        }
      });
      
      // Recherche par Entr√©e
      document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
      
      // Initialiser le nombre de membres
      document.getElementById('memberCount').value = guildMembers.length;
    });

    // ===== EXPOSITION DES FONCTIONS =====
    window.switchInventoryTab = switchInventoryTab;
    window.performSearch = performSearch;
    window.clearSearch = clearSearch;
    window.updateStatistics = updateStatistics;
    window.filtrerParCategorie = filtrerParCategorie;
    window.rechercherObjets = rechercherObjets;
    window.transferFromPersonal = transferFromPersonal;
    window.updateDistribution = updateDistribution;
    window.calculateEqualDistribution = calculateEqualDistribution;
    window.openContributionModal = openContributionModal;
    window.closeContributionModal = closeContributionModal;
    window.addNewMember = addNewMember;
    window.removeMember = removeMember;
    window.updateMemberName = updateMemberName;
    window.updateMemberClass = updateMemberClass;
    window.updateMemberContribution = updateMemberContribution;
    window.saveContributions = saveContributions;
  </script>

  <!-- Styles suppl√©mentaires pour la guilde -->
  <style>
    .section-subtitle {
      text-align: center;
      font-style: italic;
      color: var(--primary-dark);
      margin-bottom: 20px;
    }

    .distribution-config {
      background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--content-bg) 100%);
      padding: 25px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin-bottom: 25px;
    }

    .config-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .distribution-results {
      margin-top: 25px;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .distribution-card {
      background: var(--content-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      text-align: center;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .distribution-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(47, 27, 20, 0.15);
      border-color: var(--accent-gold);
    }

    .distribution-card h4 {
      margin: 0 0 10px 0;
      color: var(--primary-bg);
      font-family: var(--font-title);
    }

    .share-amount {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-gold);
      margin: 10px 0;
    }

    .share-percentage {
      color: var(--primary-dark);
      font-style: italic;
    }

    .member-contribution {
      background: var(--content-bg);
      padding: 15px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      margin-bottom: 10px;
    }

    .member-info {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto;
      gap: 10px;
      align-items: center;
    }

    .member-info input,
    .member-info select {
      margin: 0;
      padding: 8px;
      font-size: 0.9rem;
    }

    .result-source {
      font-size: 0.8rem;
      color: var(--primary-dark);
      font-style: italic;
      margin-top: 5px;
    }

    /* Responsive pour les modaux */
    @media (max-width: 768px) {
      .config-form {
        grid-template-columns: 1fr;
      }
      
      .results-grid {
        grid-template-columns: 1fr;
      }
      
      .member-info {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .popin-content {
        width: 95%;
        max-height: 95vh;
      }
    }
  </style>
</body>
</html>
