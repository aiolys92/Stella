<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventaire Dorusis</title>
  <meta name="description" content="Inventaire personnel de Dorusis - Gestion des monnaies et gemmes">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="content fade-in">
    <!-- En-tête de la page -->
    <header class="page-header">
      <h1>👤 INVENTAIRE DORUSIS 👤</h1>
      <p class="page-subtitle">Trésor personnel du guerrier</p>
    </header>

    <!-- Contrôles principaux -->
    <section class="section">
      <div class="controls-header">
        <div class="controls-left">
          <h2>💰 Gestion du Trésor</h2>
        </div>
        <div class="controls-right">
          <input type="file" accept=".json" id="fileInputInventory" style="display: none;">
          <button onclick="document.getElementById('fileInputInventory').click()" class="btn-action btn-load">
            📂 Importer
          </button>
          <button id="saveInventoryBtn" class="btn-action btn-save">
            💾 Sauvegarder
          </button>
        </div>
      </div>
      
      <!-- Affichage du total -->
      <div class="total-display">
        <span class="total-label">Valeur Totale:</span>
        <span id="totalPieces" class="total-value">0</span>
        <span class="total-unit">PM</span>
      </div>
    </section>

    <!-- Onglets des inventaires -->
    <section class="section">
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-button active" onclick="switchInventoryTab('pieces')" title="Monnaies métalliques">
            🪙 Monnaies
          </button>
          <button class="tab-button" onclick="switchInventoryTab('gemmes')" title="Gemmes précieuses">
            💎 Gemmes
          </button>
          <button class="tab-button" onclick="switchInventoryTab('search')" title="Recherche dans l'inventaire">
            🔍 Recherche
          </button>
        </div>

        <!-- Inventaire des Pièces -->
        <div id="tab-pieces" class="tab-content active">
          <div class="tab-header">
            <h2>🪙 Monnaies Métalliques</h2>
            <div class="tab-actions">
              <button onclick="addInventaireRow('pieces')" class="btn-action btn-add">
                ➕ Ajouter une monnaie
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="inventaireTablePieces" class="inventory-table">
              <thead>
                <tr>
                  <th width="30%">Nom</th>
                  <th width="20%">Quantité</th>
                  <th width="20%">Valeur Unitaire</th>
                  <th width="20%">Valeur Totale</th>
                  <th width="10%">Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Lignes générées dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Inventaire des Gemmes -->
        <div id="tab-gemmes" class="tab-content">
          <div class="tab-header">
            <h2>💎 Gemmes Précieuses</h2>
            <div class="tab-actions">
              <button onclick="addInventaireRow('gemmes')" class="btn-action btn-add">
                ➕ Ajouter une gemme
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="inventaireTableGemmes" class="inventory-table">
              <thead>
                <tr>
                  <th width="30%">Nom</th>
                  <th width="20%">Quantité</th>
                  <th width="20%">Valeur Unitaire</th>
                  <th width="20%">Valeur Totale</th>
                  <th width="10%">Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Lignes générées dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Onglet Recherche -->
        <div id="tab-search" class="tab-content">
          <div class="tab-header">
            <h2>🔍 Recherche dans le Trésor</h2>
          </div>
          
          <div class="search-container">
            <div class="search-form">
              <div>
                <label for="searchInput">Rechercher un nom:</label>
                <input type="text" id="searchInput" class="search-input" 
                       placeholder="Exemple: Or, Rubis..." 
                       oninput="performSearch()">
              </div>
              <button onclick="performSearch()" class="btn-action search-btn">
                🔍 Rechercher
              </button>
              <button onclick="clearSearch()" class="btn-action clear-btn">
                🗑️ Effacer
              </button>
            </div>
          </div>
          
          <div class="search-results" id="searchResults">
            <div class="no-results">
              <p>🔍 Tapez le nom de l'objet que vous cherchez...</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Informations sur l'inventaire -->
    <section class="section">
      <h2>📊 Statistiques de l'Inventaire</h2>
      <div class="info-grid">
        <div class="info-card">
          <h3>🪙 État des Monnaies</h3>
          <div id="statsMonetae">
            <p>Types disponibles: <span id="countMonetae">-</span></p>
            <p>Valeur moyenne: <span id="avgMonetae">-</span> PM</p>
            <p>Valeur maximale: <span id="maxMonetae">-</span> PM</p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>💎 État des Gemmes</h3>
          <div id="statsGemmae">
            <p>Types disponibles: <span id="countGemmae">-</span></p>
            <p>Valeur moyenne: <span id="avgGemmae">-</span> PM</p>
            <p>Valeur maximale: <span id="maxGemmae">-</span> PM</p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>⚖️ Total de l'Inventaire</h3>
          <div id="statsTotal">
            <p>Objets totaux: <span id="countTotal">0</span></p>
            <p>Valeur totale: <span id="valueTotal">0</span> PM</p>
            <p>État du trésor: <span id="statusTotal">Vide</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>📈 Distribution</h3>
          <div id="statsDistribution">
            <p>Monnaies: <span id="percentMonetae">0%</span> de la valeur</p>
            <p>Gemmes: <span id="percentGemmae">0%</span> de la valeur</p>
            <p>Ratio: <span id="ratioMG">-</span></p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="script.js"></script>
  <script src="nav.js"></script>
  <script>
    // Variables globales pour la page Dorusis
    let currentInventoryTab = 'pieces';

    // ===== GESTION DES ONGLETS D'INVENTAIRE =====
    function switchInventoryTab(tabName) {
      // Désactiver tous les onglets
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      // Activer l'onglet sélectionné
      const tabButton = document.querySelector(`[onclick="switchInventoryTab('${tabName}')"]`);
      const tabContent = document.getElementById(`tab-${tabName}`);
      
      if (tabButton && tabContent) {
        tabButton.classList.add('active');
        tabContent.classList.add('active');
        currentInventoryTab = tabName;
        
        if (tabName === 'search') {
          document.getElementById('searchInput').focus();
        }
      }
    }

    // ===== FONCTIONS DE RECHERCHE =====
    function performSearch() {
      const query = document.getElementById('searchInput').value.toLowerCase().trim();
      const resultsContainer = document.getElementById('searchResults');
      
      if (!query) {
        resultsContainer.innerHTML = '<div class="no-results"><p>🔍 Tapez le nom de l\'objet que vous cherchez...</p></div>';
        return;
      }
      
      const results = [];
      
      // Rechercher dans les pièces
      Object.entries(window.monnaies.pieces).forEach(([nom, valeur]) => {
        if (nom.toLowerCase().includes(query)) {
          results.push({
            nom: nom,
            valeur: valeur,
            categorie: 'Monnaies',
            type: 'pieces'
          });
        }
      });
      
      // Rechercher dans les gemmes
      Object.entries(window.monnaies.gemmes).forEach(([nom, valeur]) => {
        if (nom.toLowerCase().includes(query)) {
          results.push({
            nom: nom,
            valeur: valeur,
            categorie: 'Gemmes',
            type: 'gemmes'
          });
        }
      });
      
      displaySearchResults(results, query);
    }
    
    function displaySearchResults(results, query) {
      const container = document.getElementById('searchResults');
      
      if (results.length === 0) {
        container.innerHTML = `
          <div class="no-results">
            <p>❌ Aucun résultat pour "${query}"</p>
            <p><em>Essayez une autre recherche...</em></p>
          </div>
        `;
        return;
      }
      
      const html = results.map(item => `
        <div class="result-item">
          <div class="result-header">
            <span class="result-name">${item.nom}</span>
            <span class="result-category">${item.categorie}</span>
          </div>
          <div class="result-value">Valeur: ${item.valeur} PM</div>
        </div>
      `).join('');
      
      container.innerHTML = `
        <h3>📋 Résultats pour "${query}" (${results.length})</h3>
        ${html}
      `;
    }
    
    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResults').innerHTML = '<div class="no-results"><p>🔍 Tapez le nom de l\'objet que vous cherchez...</p></div>';
    }

    // ===== STATISTIQUES =====
    function updateStatistics() {
      if (!window.monnaies) return;
      
      // Statistiques des monnaies
      const monetaeKeys = Object.keys(window.monnaies.pieces);
      const monetaeValues = Object.values(window.monnaies.pieces);
      const avgMonetae = monetaeValues.reduce((a, b) => a + b, 0) / monetaeValues.length;
      const maxMonetae = Math.max(...monetaeValues);
      
      document.getElementById('countMonetae').textContent = monetaeKeys.length;
      document.getElementById('avgMonetae').textContent = avgMonetae.toFixed(2);
      document.getElementById('maxMonetae').textContent = maxMonetae.toFixed(2);
      
      // Statistiques des gemmes
      const gemmaeKeys = Object.keys(window.monnaies.gemmes);
      const gemmaeValues = Object.values(window.monnaies.gemmes);
      const avgGemmae = gemmaeValues.reduce((a, b) => a + b, 0) / gemmaeValues.length;
      const maxGemmae = Math.max(...gemmaeValues);
      
      document.getElementById('countGemmae').textContent = gemmaeKeys.length;
      document.getElementById('avgGemmae').textContent = avgGemmae.toFixed(2);
      document.getElementById('maxGemmae').textContent = maxGemmae.toFixed(2);
      
      // Calculs pour l'inventaire actuel
      const totalItems = document.querySelectorAll('#inventaireTablePieces tbody tr, #inventaireTableGemmes tbody tr').length;
      const totalValue = parseFloat(document.getElementById('totalPieces').textContent) || 0;
      
      document.getElementById('countTotal').textContent = totalItems;
      document.getElementById('valueTotal').textContent = totalValue.toFixed(2);
      
      // Status du trésor
      let status = 'Vide';
      if (totalValue > 1000) status = 'Très riche';
      else if (totalValue > 500) status = 'Riche';
      else if (totalValue > 100) status = 'Modeste';
      else if (totalValue > 0) status = 'Pauvre';
      
      document.getElementById('statusTotal').textContent = status;
      
      // Distribution des valeurs
      let monetaeTotal = 0, gemmaeTotal = 0;
      
      document.querySelectorAll('#inventaireTablePieces .total').forEach(cell => {
        monetaeTotal += parseFloat(cell.textContent) || 0;
      });
      
      document.querySelectorAll('#inventaireTableGemmes .total').forEach(cell => {
        gemmaeTotal += parseFloat(cell.textContent) || 0;
      });
      
      const percentMonetae = totalValue > 0 ? (monetaeTotal / totalValue * 100).toFixed(1) : 0;
      const percentGemmae = totalValue > 0 ? (gemmaeTotal / totalValue * 100).toFixed(1) : 0;
      const ratio = gemmaeTotal > 0 ? (monetaeTotal / gemmaeTotal).toFixed(2) : '-';
      
      document.getElementById('percentMonetae').textContent = percentMonetae + '%';
      document.getElementById('percentGemmae').textContent = percentGemmae + '%';
      document.getElementById('ratioMG').textContent = ratio;
    }

    // ===== INITIALISATION =====
    document.addEventListener('DOMContentLoaded', function() {
      console.log('👤 Inventaire Dorusis - Initialisé');
      
      // Mettre à jour les statistiques
      updateStatistics();
      
      // Observer les changements dans les tableaux pour mettre à jour les stats
      const observer = new MutationObserver(updateStatistics);
      
      const tables = document.querySelectorAll('#inventaireTablePieces tbody, #inventaireTableGemmes tbody');
      tables.forEach(table => {
        observer.observe(table, { childList: true, subtree: true });
      });
      
      // Observer les changements du total
      const totalObserver = new MutationObserver(updateStatistics);
      const totalElement = document.getElementById('totalPieces');
      if (totalElement) {
        totalObserver.observe(totalElement, { childList: true, characterData: true, subtree: true });
      }
      
      // Recherche en temps réel
      document.getElementById('searchInput').addEventListener('input', function() {
        if (this.value.length >= 2) {
          performSearch();
        } else if (this.value.length === 0) {
          clearSearch();
        }
      });
      
      // Recherche par Entrée
      document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
    });

    // ===== EXPOSITION DES FONCTIONS =====
    window.switchInventoryTab = switchInventoryTab;
    window.performSearch = performSearch;
    window.clearSearch = clearSearch;
    window.updateStatistics = updateStatistics;
  </script>
</body>
</html>
