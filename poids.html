<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gestio Ponderum</title>
  <meta name="description" content="Gestio ponderum objectorum et inventariorum per categorias">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="content fade-in">
    <!-- En-tÃªte de la page -->
    <header class="page-header">
      <h1>ğŸ‹ï¸ GESTIO PONDERUM ğŸ‹ï¸</h1>
      <p class="page-subtitle">Gestio inventariorum per pondera cum categoriis et pondere portato</p>
    </header>

    <!-- Section Ajout d'objets - CTA avec pop-in -->
    <section class="section">
      <div class="cta-container">
        <div class="cta-content">
          <h2>â• Creare Novum Objectum</h2>
          <p>Addere propria objecta cum eorum pondere in categoria</p>
          <button onclick="ouvrirPopinAjout()" class="cta-button">
            âœ¨ Addere objectum personalizatum
          </button>
        </div>
        <div class="cta-icon">
          ğŸ“¦
        </div>
      </div>
    </section>

    <!-- Pop-in pour ajouter un objet -->
    <div id="popinAjout" class="popin-overlay" onclick="fermerPopinAjout()">
      <div class="popin-content" onclick="event.stopPropagation()">
        <div class="popin-header">
          <h2>â• Novum Objectum</h2>
          <button onclick="fermerPopinAjout()" class="popin-close">âœ•</button>
        </div>
        
        <form class="popin-form" onsubmit="ajouterNouvelObjetPopin(event)">
          <div class="form-field">
            <label for="popinCategory">Categoria *</label>
            <select id="popinCategory" required>
              <!-- Options gÃ©nÃ©rÃ©es dynamiquement -->
            </select>
          </div>
          
          <div class="form-field">
            <label for="popinName">Nomen Objecti *</label>
            <input type="text" id="popinName" placeholder="Exemplum: Gladius magicus" required>
          </div>
          
          <div class="form-field">
            <label for="popinWeight">Pondus (kg) *</label>
            <input type="number" id="popinWeight" step="0.1" min="0" placeholder="2.5" required>
          </div>
          
          <div class="form-field">
            <label for="popinDescription">Descriptio (optionalis)</label>
            <textarea id="popinDescription" placeholder="Brevis descriptio objecti..." rows="3"></textarea>
          </div>
          
          <div class="popin-actions">
            <button type="button" onclick="fermerPopinAjout()" class="btn-cancel">
              Cancellare
            </button>
            <button type="submit" class="btn-confirm">
              âœ… Creare Objectum
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- ContrÃ´les de fichier et total -->
    <section class="section">
      <div class="controls-header">
        <div class="controls-left">
          <h2>ğŸ’¾ Gestio Filorum</h2>
        </div>
        <div class="controls-right">
          <input type="file" accept=".json" id="fileInputInventory" style="display: none;">
          <button onclick="document.getElementById('fileInputInventory').click()" class="btn-action btn-load">
            ğŸ“‚ Importare
          </button>
          <button id="saveInventoryBtn" class="btn-action btn-save">
            ğŸ’¾ Salvare Inventaria
          </button>
        </div>
      </div>
      
      <div class="total-display">
        <span class="total-label">Pondus Totale:</span>
        <span id="totalPoids" class="total-value">0</span>
        <span class="total-unit">kg</span>
      </div>
    </section>

    <!-- Onglets des inventaires -->
    <section class="section">
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-button active" onclick="switchTab('dorusis')" title="Inventarium personale Dorusis">
            ğŸ‘¤ Dorusis
          </button>
          <button class="tab-button" onclick="switchTab('cheval')" title="Inventarium equi vectorii">
            ğŸ´ Equus Vectorius
          </button>
          <button class="tab-button" onclick="switchTab('guilde')" title="Inventarium collegiale guildae">
            âš”ï¸ Guilda
          </button>
        </div>

        <!-- Inventaire Dorusis -->
        <div id="tab-dorusis" class="tab-content active">
          <div class="tab-header">
            <h2>ğŸ‘¤ Inventarium Dorusis</h2>
            <div class="tab-actions">
              <button onclick="addInventaireRowPoids('guilde')" class="btn-action btn-add">
                â• Addere Objectum
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="inventaireTableGuilde" class="inventory-table">
              <thead>
                <tr>
                  <th width="15%">Categoria</th>
                  <th width="20%">Objectum</th>
                  <th width="10%">Quantitas</th>
                  <th width="12%">Pondus Unit.</th>
                  <th width="15%">Pondus Portatum</th>
                  <th width="12%">Totale</th>
                  <th width="16%">Actiones</th>
                </tr>
              </thead>
              <tbody>
                <!-- Lignes gÃ©nÃ©rÃ©es dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Liste des objets par catÃ©gories (consultation uniquement) -->
    <section class="section">
      <h2>ğŸ“‹ Lista Objectorum per Categorias</h2>
      <p class="section-subtitle"><em>Consultatio tantum - Nullae actiones deletionis</em></p>
      
      <!-- Filtres et recherche -->
      <div class="filters-row">
        <div class="filter-group">
          <label for="categoryFilter">Categoria:</label>
          <select id="categoryFilter" onchange="filtrerParCategorie(this.value)">
            <option value="">Omnes categoriae</option>
            <!-- Options gÃ©nÃ©rÃ©es dynamiquement -->
          </select>
        </div>
        
        <div class="search-group">
          <label for="searchObjects">Quaerere:</label>
          <input type="text" id="searchObjects" placeholder="Nomen objecti..." 
                 oninput="rechercherObjets(this.value)">
        </div>
      </div>
      
      <!-- Conteneur des catÃ©gories -->
      <div class="categories-container" id="categoriesContainer">
        <!-- CatÃ©gories gÃ©nÃ©rÃ©es dynamiquement par JavaScript -->
      </div>
    </section>

    <!-- Statistiques des inventaires -->
    <section class="section">
      <h2>ğŸ“Š Statisticae Inventariorum</h2>
      <div class="info-grid">
        <div class="info-card">
          <h3>ğŸ‘¤ Inventarium Dorusis</h3>
          <div id="statsDorusis">
            <p>Objecta: <span id="countDorusis">0</span></p>
            <p>Pondus equipamentorum: <span id="weightDorusis">0</span> kg</p>
            <p>Pondus cum Dorusis: <span id="totalDorusis">80</span> kg</p>
            <p>Status: <span id="statusDorusis">Vacuus</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>ğŸ´ Inventarium Equi</h3>
          <div id="statsCheval">
            <p>Objecta: <span id="countCheval">0</span></p>
            <p>Pondus objectorum: <span id="weightCheval">0</span> kg</p>
            <p>Capacitas restans: <span id="capacityCheval">-</span> kg</p>
            <p>Status: <span id="statusCheval">Vacuus</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>âš”ï¸ Inventarium Guildae</h3>
          <div id="statsGuilde">
            <p>Objecta: <span id="countGuilde">0</span></p>
            <p>Pondus totale: <span id="weightGuilde">0</span> kg</p>
            <p>Valor estimatus: <span id="valueGuilde">-</span> PM</p>
            <p>Status: <span id="statusGuilde">Vacuus</span></p>
          </div>
        </div>
        
        <div class="info-card">
          <h3>ğŸ“ˆ Totalia Systematis</h3>
          <div id="statsTotal">
            <p>Objecta totalia: <span id="countTotalStats">0</span></p>
            <p>Pondus totale: <span id="weightTotalStats">0</span> kg</p>
            <p>Categoriae activae: <span id="categoriesActive">0</span></p>
            <p>Ultima salvatio: <span id="lastSave">Nunquam</span></p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="script.js"></script>
  <script src="poids.js"></script>
  <script src="nav.js"></script>
  
  <script>
    // Script d'initialisation spÃ©cifique Ã  la page poids
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ‹ï¸ Gestio Ponderum - InitialisÃ©');
      
      // Initialiser les statistiques
      updateStatisticsPoids();
      
      // Observer les changements dans les tableaux
      const observer = new MutationObserver(updateStatisticsPoids);
      
      document.querySelectorAll('.inventory-table tbody').forEach(tbody => {
        observer.observe(tbody, { childList: true, subtree: true });
      });
      
      // Observer les changements du total
      const totalObserver = new MutationObserver(updateStatisticsPoids);
      const totalElement = document.getElementById('totalPoids');
      if (totalElement) {
        totalObserver.observe(totalElement, { childList: true, characterData: true, subtree: true });
      }
    });

    // Fonction pour mettre Ã  jour les statistiques
    function updateStatisticsPoids() {
      // Statistiques Dorusis
      const dorusisRows = document.querySelectorAll('#inventaireTableDorusis tbody tr');
      const dorusisCount = dorusisRows.length;
      let dorusisWeight = 0;
      
      dorusisRows.forEach(row => {
        const total = row.querySelector('.poids-total');
        if (total) {
          dorusisWeight += parseFloat(total.textContent) || 0;
        }
      });
      
      document.getElementById('countDorusis').textContent = dorusisCount;
      document.getElementById('weightDorusis').textContent = dorusisWeight.toFixed(1);
      document.getElementById('totalDorusis').textContent = (80 + dorusisWeight).toFixed(1);
      
      let statusDorusis = 'Vacuus';
      if (dorusisWeight > 50) statusDorusis = 'Onustus';
      else if (dorusisWeight > 20) statusDorusis = 'Moderatus';
      else if (dorusisWeight > 0) statusDorusis = 'Levis';
      document.getElementById('statusDorusis').textContent = statusDorusis;
      
      // Statistiques Cheval
      const chevalRows = document.querySelectorAll('#inventaireTableCheval tbody tr');
      const chevalCount = chevalRows.length;
      let chevalWeight = 0;
      
      chevalRows.forEach(row => {
        const total = row.querySelector('.poids-total');
        if (total) {
          chevalWeight += parseFloat(total.textContent) || 0;
        }
      });
      
      document.getElementById('countCheval').textContent = chevalCount;
      document.getElementById('weightCheval').textContent = chevalWeight.toFixed(1);
      
      const maxCapacity = 200; // kg pour un cheval de trait
      const remaining = Math.max(0, maxCapacity - chevalWeight);
      document.getElementById('capacityCheval').textContent = remaining.toFixed(1);
      
      let statusCheval = 'Vacuus';
      if (chevalWeight > 150) statusCheval = 'Plenus';
      else if (chevalWeight > 100) statusCheval = 'Onustus';
      else if (chevalWeight > 50) statusCheval = 'Moderatus';
      else if (chevalWeight > 0) statusCheval = 'Levis';
      document.getElementById('statusCheval').textContent = statusCheval;
      
      // Statistiques Guilde
      const guildeRows = document.querySelectorAll('#inventaireTableGuilde tbody tr');
      const guildeCount = guildeRows.length;
      let guildeWeight = 0;
      
      guildeRows.forEach(row => {
        const total = row.querySelector('.poids-total');
        if (total) {
          guildeWeight += parseFloat(total.textContent) || 0;
        }
      });
      
      document.getElementById('countGuilde').textContent = guildeCount;
      document.getElementById('weightGuilde').textContent = guildeWeight.toFixed(1);
      document.getElementById('valueGuilde').textContent = '-'; // Ã€ implÃ©menter si nÃ©cessaire
      
      let statusGuilde = 'Vacuus';
      if (guildeWeight > 1000) statusGuilde = 'Magnus';
      else if (guildeWeight > 500) statusGuilde = 'Plenus';
      else if (guildeWeight > 100) statusGuilde = 'Moderatus';
      else if (guildeWeight > 0) statusGuilde = 'Levis';
      document.getElementById('statusGuilde').textContent = statusGuilde;
      
      // Totaux du systÃ¨me
      const totalCount = dorusisCount + chevalCount + guildeCount;
      const totalWeight = dorusisWeight + chevalWeight + guildeWeight + 80; // +80 pour Dorusis
      
      document.getElementById('countTotalStats').textContent = totalCount;
      document.getElementById('weightTotalStats').textContent = totalWeight.toFixed(1);
      
      // CatÃ©gories actives
      if (window.monnaies && window.monnaies.poids) {
        const activeCategories = Object.values(window.monnaies.poids)
          .filter(cat => Object.keys(cat).length > 0).length;
        document.getElementById('categoriesActive').textContent = activeCategories;
      }
    }

    // Exposer la fonction pour usage externe
    window.updateStatisticsPoids = updateStatisticsPoids;
  </script>
</body>
</html>ireRowPoids('dorusis')" class="btn-action btn-add">
                â• Addere Objectum
              </button>
              <button onclick="ajouterDorusisAuCheval()" class="btn-action btn-transfer" title="Addere Dorusis (80kg + aequipamenta) ad equum">
                ğŸ´ Ascendere Equum
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="inventaireTableDorusis" class="inventory-table">
              <thead>
                <tr>
                  <th width="15%">Categoria</th>
                  <th width="20%">Objectum</th>
                  <th width="10%">Quantitas</th>
                  <th width="12%">Pondus Unit.</th>
                  <th width="15%">Pondus Portatum</th>
                  <th width="12%">Totale</th>
                  <th width="16%">Actiones</th>
                </tr>
              </thead>
              <tbody>
                <!-- Lignes gÃ©nÃ©rÃ©es dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Inventaire Cheval -->
        <div id="tab-cheval" class="tab-content">
          <div class="tab-header">
            <h2>ğŸ´ Inventarium Equi Vectorii</h2>
            <div class="tab-actions">
              <button onclick="addInventaireRowPoids('cheval')" class="btn-action btn-add">
                â• Addere Objectum
              </button>
              <button onclick="retirerDorusis()" class="btn-action btn-remove" title="Removere Dorusis ab equo">
                ğŸ‘¤ Descendere ab Equo
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <table id="inventaireTableCheval" class="inventory-table">
              <thead>
                <tr>
                  <th width="15%">Categoria</th>
                  <th width="20%">Objectum</th>
                  <th width="10%">Quantitas</th>
                  <th width="12%">Pondus Unit.</th>
                  <th width="15%">Pondus Portatum</th>
                  <th width="12%">Totale</th>
                  <th width="16%">Actiones</th>
                </tr>
              </thead>
              <tbody>
                <!-- Lignes gÃ©nÃ©rÃ©es dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Inventaire Guilde -->
        <div id="tab-guilde" class="tab-content">
          <div class="tab-header">
            <h2>âš”ï¸ Inventarium Guildae</h2>
            <div class="tab-actions">
              <button onclick="addInventa
